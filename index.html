<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† - Firebase</title>
    
    <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„Ù…Ø¯Ù…Ø¬ -->
    <script>
        // Ù†Ø¸Ø§Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¯Ù…Ø¬
        const IconSystem = {
            // Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG
            icons: {
                'users': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',
                'calendar-plus': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><line x1="12" y1="15" x2="12" y2="19"></line><line x1="10" y1="17" x2="14" y2="17"></line></svg>',
                'clock': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12,6 12,12 16,14"></polyline></svg>',
                'user-plus': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>',
                'file-text': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10,9 9,9 8,9"></polyline></svg>',
                'log-out': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16,17 21,12 16,7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>',
                'save': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17,21 17,13 7,13 7,21"></polyline><polyline points="7,3 7,8 15,8"></polyline></svg>',
                'edit-2': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>',
                'trash-2': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3,6 5,6 21,6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',
                'x': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',
                'check': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20,6 9,17 4,12"></polyline></svg>',
                'plus': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
                'settings': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>',
                'arrow-up': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5,12 12,5 19,12"></polyline></svg>',
                'arrow-down': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19,12 12,19 5,12"></polyline></svg>',
                'chevron-right': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9,18 15,12 9,6"></polyline></svg>',
                'chevron-left': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15,18 9,12 15,6"></polyline></svg>',
                'rotate-ccw': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1,4 1,10 7,10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>',
                'history': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12,6 12,12 16,14"></polyline></svg>',
                'alert-triangle': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',
                'trending-down': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23,18 13.5,8.5 8.5,13.5 1,6"></polyline><polyline points="17,18 23,18 23,12"></polyline></svg>',
                'calendar': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
                'play': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5,3 19,12 5,21"></polygon></svg>',
                'square': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>',
                'user': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
                'check-circle': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22,4 12,14.01 9,11.01"></polyline></svg>',
                'x-circle': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',
                'alert-circle': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>'
            },

            // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            createIcons: function() {
                const iconElements = document.querySelectorAll('[data-lucide]');
                iconElements.forEach(element => {
                    const iconName = element.getAttribute('data-lucide');
                    if (this.icons[iconName]) {
                        element.innerHTML = this.icons[iconName];
                        element.style.display = 'inline-block';
                        element.style.verticalAlign = 'middle';
                    }
                });
                console.log(`âœ… Processed ${iconElements.length} icons`);
            }
        };

        // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† lucide Ù…ØªÙˆØ§ÙÙ‚
        window.lucide = {
            createIcons: function() {
                IconSystem.createIcons();
            }
        };

        console.log('âœ… Professional Icon System loaded');
    </script>

    <!-- ØªØ­Ù…ÙŠÙ„ Firebase Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ -->
    <script>
        // Ù†Ø¸Ø§Ù… ØªØ­Ù…ÙŠÙ„ Firebase Ø§Ù„Ù…Ø­Ø³Ù†
        async function loadFirebase() {
            const firebaseSources = [
                [
                    'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js',
                    'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js',
                    'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js'
                ],
                [
                    'https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js',
                    'https://www.gstatic.com/firebasejs/9.21.0/firebase-auth-compat.js',
                    'https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js'
                ]
            ];

            for (const sources of firebaseSources) {
                try {
                    console.log('ğŸ”„ Loading Firebase...');
                    
                    for (const src of sources) {
                        await loadScript(src);
                    }
                    
                    if (typeof firebase !== 'undefined') {
                        console.log('âœ… Firebase loaded successfully');
                        return true;
                    }
                } catch (error) {
                    console.warn('âš ï¸ Firebase source failed, trying next...', error);
                }
            }
            
            console.warn('âŒ All Firebase sources failed - using local mode');
            return false;
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const existingScript = document.querySelector(`script[src="${src}"]`);
                if (existingScript) {
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                
                const timeout = setTimeout(() => {
                    reject(new Error(`Timeout: ${src}`));
                }, 8000);

                script.onload = () => {
                    clearTimeout(timeout);
                    resolve();
                };

                script.onerror = () => {
                    clearTimeout(timeout);
                    reject(new Error(`Failed: ${src}`));
                };

                document.head.appendChild(script);
            });
        }

        // Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Firebase
        window.firebaseLoadingPromise = loadFirebase();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #001a4d 0%, #002366 50%, #001a4d 100%);
            color: #ffffff;
            min-height: 100vh;
            direction: rtl;
        }

        :root {
            --primary-900: #001a4d;
            --primary-800: #002366;
            --primary-700: #003080;
            --primary-600: #004099;
            --primary-500: #0050b3;
            --primary-400: #1677ff;
            --primary-300: #4096ff;
            --primary-200: #69b1ff;
            --primary-100: #91caff;
            
            --neon-blue: #00d4ff;
            --neon-green: #00ff88;
            --neon-yellow: #ffeb3b;
            --neon-red: #ff4444;
            --neon-orange: #ff9800;
        }

        .neon-text {
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue);
        }

        .card-neon {
            background: rgba(0, 35, 102, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .btn-neon {
            background: linear-gradient(45deg, var(--neon-blue), var(--primary-600));
            border: 1px solid var(--neon-blue);
            color: white;
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn-neon:hover {
            box-shadow: 0 0 20px var(--neon-blue);
            transform: translateY(-2px);
        }

        .btn-neon:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-neon {
            background: rgba(0, 35, 102, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: white;
            transition: all 0.3s ease;
            padding: 0.75rem;
            border-radius: 8px;
            width: 100%;
        }

        .input-neon:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .login-card {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            border-radius: 12px;
        }

        .login-title {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary-200);
            font-weight: 500;
        }

        .notification {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: var(--neon-green);
        }

        .notification.error {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            color: var(--neon-red);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--neon-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .text-center { text-align: center; }
        .text-sm { font-size: 0.875rem; }
        .mt-4 { margin-top: 1rem; }
        .text-gray { color: var(--primary-200); }

        .main-screen {
            padding: 2rem;
        }

        .welcome-message {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logout-btn {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid rgba(255, 68, 68, 0.5);
            color: #ff4444;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            float: left;
            margin-bottom: 2rem;
        }

        .logout-btn:hover {
            background: rgba(255, 68, 68, 0.3);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .remember-me-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .remember-me-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--neon-blue);
            cursor: pointer;
        }

        .forgot-password-link {
            color: var(--neon-blue);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .forgot-password-link:hover {
            color: var(--neon-green);
            text-shadow: 0 0 5px var(--neon-green);
        }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--primary-900) 0%, var(--primary-800) 100%);
            border: 2px solid var(--neon-blue);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-title {
            color: var(--neon-blue);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .modal-message {
            color: white;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .modal-btn.funny {
            background: linear-gradient(45deg, var(--neon-yellow), #ff9800);
            color: var(--primary-900);
            font-weight: bold;
        }

        .modal-btn.funny:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 235, 59, 0.4);
        }

        .modal-btn.primary {
            background: linear-gradient(45deg, var(--neon-blue), var(--primary-600));
            color: white;
        }

        .modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ© */
        .seasonal-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-900) 0%, var(--primary-800) 100%);
            border: 2px solid var(--neon-green);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            color: white;
            font-size: 1rem;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            z-index: 999;
            transform: translateX(120%);
            transition: all 0.5s ease;
            max-width: 350px;
            opacity: 0;
            visibility: hidden;
        }

        .seasonal-message.show {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }

        .seasonal-message .close-btn {
            position: absolute;
            top: 5px;
            left: 10px;
            background: none;
            border: none;
            color: var(--neon-red);
            font-size: 1.2rem;
            cursor: pointer;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³ÙŠØ§Ù† */
        .forget-counter {
            background: rgba(255, 235, 59, 0.1);
            border: 1px solid rgba(255, 235, 59, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--neon-yellow);
            text-align: center;
        }

        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
        @media (max-width: 1200px) {
            #balancesContent {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important;
            }
        }

        @media (max-width: 768px) {
            .main-screen {
                padding: 1rem;
            }
            
            #balancesContent {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
                gap: 0.75rem !important;
            }
            
            .tab-button {
                padding: 0.75rem 1rem !important;
                font-size: 0.9rem;
            }
            
            .welcome-message h1 {
                font-size: 1.5rem;
            }
            
            /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            .main-screen > div:first-of-type {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
            }
            
            /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            .btn-neon, .tab-button, button {
                min-height: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            .input-neon, input, select, textarea {
                min-height: 44px;
                font-size: 16px; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø¹Ù„Ù‰ iOS */
                -webkit-appearance: none;
                appearance: none;
            }
        }

        @media (max-width: 480px) {
            #balancesContent {
                grid-template-columns: 1fr !important;
            }
            
            .tab-button {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.8rem;
            }
            
            .tab-button span {
                display: none;
            }
            
            /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
            .main-screen > div:first-of-type {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important;
            }
            
            /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª */
            #saturdayTable {
                border-radius: 8px;
                overflow: hidden;
            }
            
            #saturdayTable th {
                background: rgba(0, 35, 102, 0.5);
                font-size: 0.9rem;
            }
            
            #saturdayTable td {
                font-size: 0.9rem;
            }
            
            #saturdayTable tbody tr:hover {
                background: rgba(0, 212, 255, 0.05);
            }
            
            /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† */
            #employeesTable {
                border-radius: 8px;
                overflow: hidden;
            }
            
            #employeesTable th {
                background: rgba(0, 35, 102, 0.5);
                font-size: 0.9rem;
            }
            
            #employeesTable td {
                font-size: 0.9rem;
            }
            
            #employeesTable tbody tr:hover {
                background: rgba(0, 212, 255, 0.05);
            }
            
            /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
            .edit-employee-btn:hover {
                background: rgba(0, 212, 255, 0.3) !important;
                transform: translateY(-1px);
            }
            
            .delete-employee-btn:hover {
                background: rgba(255, 68, 68, 0.3) !important;
                transform: translateY(-1px);
            }
            
            /* Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡ */
            #cancelEmployeeBtn:hover {
                background: rgba(255, 68, 68, 0.3);
            }
            
            /* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© */
            #photoPreview {
                transition: all 0.3s ease;
            }
            
            #photoPreview:hover {
                transform: scale(1.1);
                box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
            }
            
            /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ… */
            #prevPage:disabled,
            #nextPage:disabled {
                cursor: not-allowed;
                opacity: 0.5;
            }
            
            /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
            .employee-photo {
                transition: transform 0.3s ease;
            }
            
            .employee-photo:hover {
                transform: scale(1.2);
            }
            
            /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .modal-content {
                width: 90%;
                max-width: 500px;
                padding: 2rem;
                border-radius: 12px;
                max-height: 80vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginScreen" class="login-container">
        <div class="login-card card-neon">
            <h1 class="login-title neon-text">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h1>
            
            <div id="loginNotification"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="text" id="loginEmail" class="input-neon" required value="admin" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="loginPassword" class="input-neon" required value="admin123" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                
                <!-- Ù…Ø±Ø¨Ø¹ ØªØ°ÙƒØ±Ù†ÙŠ -->
                <div class="remember-me-container">
                    <input type="checkbox" id="rememberMe" class="remember-me-checkbox">
                    <label for="rememberMe" style="color: var(--primary-200); cursor: pointer;">ØªØ°ÙƒØ±Ù†ÙŠ</label>
                    <div style="flex: 1;"></div>
                    <a href="#" id="forgotPasswordLink" class="forgot-password-link">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
                </div>
                
                <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³ÙŠØ§Ù† - Ù…Ø­Ø°ÙˆÙ -->
                
                <button type="submit" id="loginBtn" class="btn-neon" style="width: 100%;">
                    <span id="loginBtnText">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                    <div id="loginLoading" class="loading hidden"></div>
                </button>
            </form>
            
            <div class="mt-4 text-center text-sm text-gray">
                <p>Ø­Ø³Ø§Ø¨Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©:</p>
                <p>Ù…Ø¯ÙŠØ±: admin Ø£Ùˆ admin@company.com / admin123</p>
                <p>Ù…Ø´Ø±Ù: supervisor Ø£Ùˆ supervisor@company.com / super123</p>
                <p>Ù…ÙˆØ¸Ù: employee Ø£Ùˆ employee@company.com / emp123</p>
                <p style="margin-top: 0.5rem; color: var(--neon-blue);">ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù†Ø³ÙŠØ§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
    <div id="forgotPasswordModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ¤¦â€â™‚ï¸ Ø£ÙˆÙˆÙˆÙˆÙˆØ¨Ø³!</h2>
            <div id="forgotPasswordMessage" class="modal-message"></div>
            <div class="modal-buttons">
                <button class="modal-btn funny" onclick="closeForgotPasswordModal()">ğŸ˜‚ Ù‡Ù‡Ù‡Ù‡Ù‡Ù‡</button>
                <button class="modal-btn primary" onclick="resetPassword()">ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§ Ù†ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±! ğŸ”</button>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ© -->
    <div id="seasonalMessage" class="seasonal-message">
        <button class="close-btn" onclick="closeSeasonalMessage()">Ã—</button>
        <div id="seasonalMessageContent"></div>
    </div>

    <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainScreen" class="hidden">
        <div class="main-screen">
            <button id="logoutBtn" class="logout-btn">
                <i data-lucide="log-out"></i>
                Ø®Ø±ÙˆØ¬
            </button>
            
            <div class="welcome-message">
                <h1 class="neon-text">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h1>
                <p id="userWelcome" class="text-gray mt-4"></p>
            </div>
            
            <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <!-- Ø£Ø±ØµØ¯Ø© Ù…Ù†ØªÙ‡ÙŠØ© -->
                <div class="card-neon" style="padding: 1.5rem; border-radius: 12px; background: linear-gradient(135deg, rgba(255, 68, 68, 0.1) 0%, rgba(255, 68, 68, 0.05) 100%); border-color: rgba(255, 68, 68, 0.3);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h3 style="color: var(--neon-red); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="expiredBalances">0</h3>
                            <p style="color: var(--primary-200); font-size: 0.9rem;">Ø£Ø±ØµØ¯Ø© Ù…Ù†ØªÙ‡ÙŠØ©</p>
                        </div>
                        <div style="background: rgba(255, 68, 68, 0.2); border-radius: 50%; padding: 1rem;">
                            <i data-lucide="trending-down" style="width: 24px; height: 24px; color: var(--neon-red);"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ -->
                <div class="card-neon" style="padding: 1.5rem; border-radius: 12px; background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%); border-color: rgba(0, 255, 136, 0.3);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h3 style="color: var(--neon-green); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="weekSaturdays">0</h3>
                            <p style="color: var(--primary-200); font-size: 0.9rem;">Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
                        </div>
                        <div style="background: rgba(0, 255, 136, 0.2); border-radius: 50%; padding: 1rem;">
                            <i data-lucide="clock" style="width: 24px; height: 24px; color: var(--neon-green);"></i>
                        </div>
                    </div>
                </div>
                
                <!-- ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… -->
                <div class="card-neon" style="padding: 1.5rem; border-radius: 12px; background: linear-gradient(135deg, rgba(255, 235, 59, 0.1) 0%, rgba(255, 235, 59, 0.05) 100%); border-color: rgba(255, 235, 59, 0.3);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h3 style="color: var(--neon-yellow); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="todayLeaves">0</h3>
                            <p style="color: var(--primary-200); font-size: 0.9rem;">ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                        <div style="background: rgba(255, 235, 59, 0.2); border-radius: 50%; padding: 1rem;">
                            <i data-lucide="calendar" style="width: 24px; height: 24px; color: var(--neon-yellow);"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
                <div class="card-neon" style="padding: 1.5rem; border-radius: 12px; background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(0, 212, 255, 0.05) 100%); border-color: rgba(0, 212, 255, 0.3);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h3 style="color: var(--neon-blue); font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;" id="totalEmployees">0</h3>
                            <p style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
                        </div>
                        <div style="background: rgba(0, 212, 255, 0.2); border-radius: 50%; padding: 1rem;">
                            <i data-lucide="users" style="width: 24px; height: 24px; color: var(--neon-blue);"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card-neon" style="padding: 2rem; border-radius: 12px;">
                <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
                <div style="display: flex; overflow-x: auto; background: rgba(0, 35, 102, 0.3); border-radius: 8px; margin-bottom: 2rem;">
                    <button class="tab-button active" data-tab="balances" style="background: none; border: none; color: var(--neon-blue); padding: 1rem 1.5rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; white-space: nowrap; border-bottom: 2px solid var(--neon-blue);">
                        <i data-lucide="users"></i>
                        Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±ØµØ¯Ø©
                    </button>
                    <button class="tab-button" data-tab="record" style="background: none; border: none; color: var(--primary-200); padding: 1rem 1.5rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; white-space: nowrap; border-bottom: 2px solid transparent;">
                        <i data-lucide="calendar-plus"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ©
                    </button>
                    <button class="tab-button" data-tab="saturday" style="background: none; border: none; color: var(--primary-200); padding: 1rem 1.5rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; white-space: nowrap; border-bottom: 2px solid transparent;">
                        <i data-lucide="clock"></i>
                        Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª
                    </button>
                    <button class="tab-button" data-tab="employees" style="background: none; border: none; color: var(--primary-200); padding: 1rem 1.5rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; white-space: nowrap; border-bottom: 2px solid transparent;">
                        <i data-lucide="user-plus"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                    </button>
                    <button class="tab-button" data-tab="records" style="background: none; border: none; color: var(--primary-200); padding: 1rem 1.5rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; white-space: nowrap; border-bottom: 2px solid transparent;">
                        <i data-lucide="file-text"></i>
                        Ø§Ù„Ø³Ø¬Ù„
                    </button>
                </div>

                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
                <div id="tabContent">
                    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£Ø±ØµØ¯Ø© -->
                    <div id="balancesTab" class="tab-panel">
                        <h2 style="color: var(--neon-blue); margin-bottom: 1.5rem; font-size: 1.5rem;">Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
                        <div id="balancesContent" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; overflow-y: visible;">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                        </div>
                    </div>

                    <!-- ØªØ¨ÙˆÙŠØ¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© -->
                    <div id="recordTab" class="tab-panel hidden">
                        <h2 style="color: var(--neon-blue); margin-bottom: 1.5rem; font-size: 1.5rem;">ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                        
                        <div id="recordNotification"></div>
                        
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
                            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
                            <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                                <form id="recordForm">
                                    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù -->
                                    <div class="form-group">
                                        <label class="form-label">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                        <select id="recordEmployee" class="input-neon" required>
                                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ© -->
                                    <div class="form-group">
                                        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©</label>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem;">
                                            <button type="button" class="leave-type-btn active" data-type="regular" style="padding: 0.75rem; border-radius: 8px; border: 2px solid var(--neon-green); background: rgba(0, 255, 136, 0.1); color: var(--neon-green); cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem;">
                                                Ø¥Ø¬Ø§Ø²Ø© Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©
                                            </button>
                                            <button type="button" class="leave-type-btn" data-type="emergency" style="padding: 0.75rem; border-radius: 8px; border: 2px solid var(--primary-600); background: none; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem;">
                                                Ø¥Ø¬Ø§Ø²Ø© Ø¹Ø§Ø±Ø¶Ø©
                                            </button>
                                            <button type="button" class="leave-type-btn" data-type="sick" style="padding: 0.75rem; border-radius: 8px; border: 2px solid var(--primary-600); background: none; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem;">
                                                Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ©
                                            </button>
                                            <button type="button" class="leave-type-btn" data-type="permission" style="padding: 0.75rem; border-radius: 8px; border: 2px solid var(--primary-600); background: none; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem;">
                                                Ø¥Ø°Ù†
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® -->
                                    <div id="dateFields">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                            <div class="form-group">
                                                <label class="form-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                                                <input type="date" id="startDate" class="input-neon" required>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                                                <input type="date" id="endDate" class="input-neon" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª (Ù„Ù„Ø£Ø°ÙˆÙ†Ø§Øª) -->
                                    <div id="timeFields" class="hidden">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                            <div class="form-group">
                                                <label class="form-label">Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø©</label>
                                                <input type="time" id="startTime" class="input-neon">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø©</label>
                                                <input type="time" id="endTime" class="input-neon">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© -->
                                    <div id="calculatedDuration" class="hidden" style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <i data-lucide="clock" style="width: 20px; height: 20px; color: var(--neon-blue);"></i>
                                            <span id="durationText" style="color: var(--neon-blue); font-weight: 500;"></span>
                                        </div>
                                        <div id="permissionWarning" class="hidden" style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--neon-orange);">
                                            âš ï¸ Ø³ÙŠØªÙ… Ø®ØµÙ… Ø£ÙŠØ§Ù… Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ
                                        </div>
                                    </div>
                                    
                                    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                                    <div class="form-group">
                                        <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                        <textarea id="recordNotes" class="input-neon" style="min-height: 80px; resize: vertical;" placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                                    </div>
                                    
                                    <!-- Ø²Ø± Ø§Ù„Ø­ÙØ¸ -->
                                    <button type="submit" id="recordSubmitBtn" class="btn-neon" style="width: 100%;">
                                        <i data-lucide="save"></i>
                                        Ø­ÙØ¸ Ø§Ù„Ø­Ø±ÙƒØ©
                                    </button>
                                </form>
                            </div>
                            
                            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù -->
                            <div>
                                <div id="employeeBalance" class="card-neon hidden" style="padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                                    <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem;">Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ¸Ù</h3>
                                    <div id="balanceInfo"></div>
                                </div>
                                
                                <!-- Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† -->
                                <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                                    <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem;">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
                                    <div style="display: flex; flex-direction: column; gap: 0.5rem;"></div>
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                            <div style="width: 16px; height: 16px; border-radius: 50%; background: var(--neon-green);"></div>
                                            <span style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø¬Ø§Ø²Ø© Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                            <div style="width: 16px; height: 16px; border-radius: 50%; background: var(--neon-yellow);"></div>
                                            <span style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø¬Ø§Ø²Ø© Ø¹Ø§Ø±Ø¶Ø©</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                            <div style="width: 16px; height: 16px; border-radius: 50%; background: var(--neon-red);"></div>
                                            <span style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ©</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <div style="width: 16px; height: 16px; border-radius: 50%; background: var(--neon-orange);"></div>
                                            <span style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø°Ù† / Ø®ØµÙ… Ø£Ø°ÙˆÙ†Ø§Øª</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ØªØ¨ÙˆÙŠØ¨ Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª -->
                    <div id="saturdayTab" class="tab-panel hidden">
                        <h2 style="color: var(--neon-blue); margin-bottom: 1.5rem; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="clock" style="width: 24px; height: 24px;"></i>
                            Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª
                        </h2>
                        
                        <div id="saturdayNotification"></div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                            <!-- ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø¬Ø¯ÙŠØ¯ -->
                            <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                                <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem;">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
                                
                                <form id="saturdayAttendanceForm">
                                    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù -->
                                    <div class="form-group">
                                        <label class="form-label">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                        <select id="attendanceEmployee" class="input-neon" required>
                                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>
                                        </select>
                                    </div>
                                    
                                    <!-- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
                                    <div class="form-group">
                                        <label class="form-label">ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø¥Ø°Ø§ ØªÙØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ø³ÙŠÙØ³ØªØ®Ø¯Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ)</label>
                                        <input type="time" id="customArrivalTime" class="input-neon" placeholder="Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ">
                                    </div>
                                    
                                    <!-- ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
                                    <div class="form-group" id="departureTimeGroup" style="display: none;">
                                        <label class="form-label">ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø¥Ø°Ø§ ØªÙØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ø³ÙŠÙØ³ØªØ®Ø¯Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ)</label>
                                        <input type="time" id="customDepartureTime" class="input-neon" placeholder="Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ">
                                    </div>
                                    
                                    <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù -->
                                    <button type="submit" id="attendanceBtn" class="btn-neon" style="width: 100%; margin-bottom: 1rem;">
                                        <i data-lucide="play" id="attendanceIcon"></i>
                                        <span id="attendanceBtnText">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</span>
                                    </button>
                                </form>
                                
                                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
                                <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem;">
                                    <h4 style="color: var(--neon-blue); margin-bottom: 0.75rem; font-size: 1rem;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h4>
                                    
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="color: var(--primary-200);">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</span>
                                        <span style="color: var(--neon-yellow); font-weight: bold;">8 Ø³Ø§Ø¹Ø§Øª</span>
                                    </div>
                                    
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="color: var(--primary-200);">Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</span>
                                        <span style="color: var(--neon-green); font-weight: bold;" id="todayAttendees">0</span>
                                    </div>
                                    
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: var(--primary-200);">Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
                                        <span style="color: var(--neon-blue); font-weight: bold;" id="currentDate"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ -->
                            <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                                <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <i data-lucide="clock" style="width: 20px; height: 20px;"></i>
                                    Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹
                                </h3>
                                
                                <div id="currentAttendees" style="max-height: 300px; overflow-y: auto;">
                                    <div style="text-align: center; padding: 2rem; color: var(--primary-200);">
                                        <i data-lucide="clock" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5;"></i>
                                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ø­Ø§Ø¶Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ø³Ø¬Ù„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª -->
                        <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                            <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem;">Ø³Ø¬Ù„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª</h3>
                            
                            <div style="overflow-x: auto;">
                                <table id="saturdayTable" style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.3);">
                                            <th style="padding: 0.75rem; text-align: right; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        </tr>
                                    </thead>
                                    <tbody id="saturdayTableBody">
                                        <tr>
                                            <td colspan="6" style="text-align: center; padding: 3rem; color: var(--primary-200);">
                                                <i data-lucide="calendar" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5;"></i>
                                                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø©</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
                    <div id="employeesTab" class="tab-panel hidden">
                        <h2 style="color: var(--neon-blue); margin-bottom: 1.5rem; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i data-lucide="user-plus" style="width: 24px; height: 24px;"></i>
                            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                        </h2>
                        
                        <div id="employeesNotification"></div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                            <!-- Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¸Ù -->
                            <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                                <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem;" id="employeeFormTitle">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
                                
                                <form id="employeeForm">
                                    <!-- Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù -->
                                    <div class="form-group">
                                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                        <input type="text" id="employeeName" class="input-neon" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„ÙƒØ§Ù…Ù„">
                                    </div>
                                    
                                    <!-- Ø§Ù„Ù‚Ø³Ù… -->
                                    <div class="form-group">
                                        <label class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <select id="employeeDepartment" class="input-neon" required style="flex: 1;">
                                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --</option>
                                            </select>
                                            <button type="button" id="manageDepartmentsBtn" class="btn-neon" style="padding: 0.75rem; width: auto;">
                                                <i data-lucide="settings"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Ø§Ù„Ø£Ø±ØµØ¯Ø© -->
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <div class="form-group">
                                            <label class="form-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ</label>
                                            <input type="number" id="regularBalance" class="input-neon" min="0" max="60" value="30" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©</label>
                                            <input type="number" id="emergencyBalance" class="input-neon" min="0" max="15" value="7" required>
                                        </div>
                                    </div>
                                    
                                    <!-- Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© -->
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <div class="form-group">
                                            <label class="form-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ</label>
                                            <input type="number" id="regularUsed" class="input-neon" min="0" value="0">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©</label>
                                            <input type="number" id="emergencyUsed" class="input-neon" min="0" value="0">
                                        </div>
                                    </div>
                                    
                                    <!-- Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…Ø±Ø¶ÙŠØ© -->
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <div class="form-group">
                                            <label class="form-label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</label>
                                            <input type="number" id="permissionHours" class="input-neon" min="0" value="0">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…Ø±Ø¶ÙŠØ©</label>
                                            <input type="number" id="sickUsed" class="input-neon" min="0" value="0">
                                        </div>
                                    </div>
                                    
                                    <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù -->
                                    <div class="form-group">
                                        <label class="form-label">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                        <div style="display: flex; align-items: center; gap: 1rem;">
                                            <input type="file" id="employeePhoto" class="input-neon" accept="image/*" style="flex: 1;">
                                            <div id="photoPreview" class="hidden" style="width: 60px; height: 60px; border-radius: 50%; overflow: hidden; border: 2px solid var(--neon-blue);">
                                                <img id="previewImg" style="width: 100%; height: 100%; object-fit: cover;">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                                    <div class="form-group">
                                        <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                        <textarea id="employeeNotes" class="input-neon" style="min-height: 80px; resize: vertical;" placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸Ù..."></textarea>
                                    </div>
                                    
                                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ù„ØºØ§Ø¡ -->
                                    <div style="display: flex; gap: 1rem;">
                                        <button type="submit" id="saveEmployeeBtn" class="btn-neon" style="flex: 1;">
                                            <i data-lucide="save"></i>
                                            <span id="saveEmployeeBtnText">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù</span>
                                        </button>
                                        <button type="button" id="cancelEmployeeBtn" class="hidden" style="flex: 1; background: rgba(255, 68, 68, 0.2); border: 1px solid rgba(255, 68, 68, 0.5); color: #ff4444; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                                            <i data-lucide="x"></i>
                                            Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
                            <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                                <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="color: var(--neon-blue); font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;" id="totalEmployeesCount">0</div>
                                        <div style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                                    </div>
                                    
                                    <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="color: var(--neon-red); font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;" id="lowBalanceCount">0</div>
                                        <div style="color: var(--primary-200); font-size: 0.9rem;">Ø£Ø±ØµØ¯Ø© Ù…Ù†Ø®ÙØ¶Ø©</div>
                                    </div>
                                    
                                    <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="color: var(--neon-green); font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;" id="activeDepartments">0</div>
                                        <div style="color: var(--primary-200); font-size: 0.9rem;">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©</div>
                                    </div>
                                    
                                    <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                                        <div style="color: var(--neon-yellow); font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;" id="avgBalance">0</div>
                                        <div style="color: var(--primary-200); font-size: 0.9rem;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±ØµÙŠØ¯</div>
                                    </div>
                                </div>
                                
                                <!-- ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… -->
                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label class="form-label">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</label>
                                    <select id="departmentFilter" class="input-neon">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                                        <option value="ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                                        <option value="Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
                                        <option value="Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                                        <option value="Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©">Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</option>
                                        <option value="Ø§Ù„ØªØ³ÙˆÙŠÙ‚">Ø§Ù„ØªØ³ÙˆÙŠÙ‚</option>
                                        <option value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                                        <option value="Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡">Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
                                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© -->
                        <div class="card-neon" style="padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                            <h3 style="color: var(--neon-blue); margin-bottom: 1rem; font-size: 1.1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i data-lucide="rotate-ccw" style="width: 20px; height: 20px;"></i>
                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©
                            </h3>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div>
                                    <div style="margin-bottom: 0.75rem;">
                                        <span style="color: var(--primary-200); font-size: 0.9rem;">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                                        <div style="color: var(--neon-blue); font-weight: bold;" id="currentFiscalYear">2024-2025</div>
                                    </div>
                                    <div style="margin-bottom: 0.75rem;">
                                        <span style="color: var(--primary-200); font-size: 0.9rem;">Ø¢Ø®Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†:</span>
                                        <div style="color: var(--neon-green); font-weight: bold;" id="lastResetDate">Ù„Ù… ÙŠØªÙ… Ø¨Ø¹Ø¯</div>
                                    </div>
                                </div>
                                <div>
                                    <div style="margin-bottom: 0.75rem;">
                                        <span style="color: var(--primary-200); font-size: 0.9rem;">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                                        <div style="font-weight: bold;" id="resetStatus">
                                            <span style="color: var(--neon-yellow);">âš ï¸ Ù…Ø·Ù„ÙˆØ¨</span>
                                        </div>
                                    </div>
                                    <div>
                                        <span style="color: var(--primary-200); font-size: 0.9rem;">Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ 1 ÙŠÙˆÙ„ÙŠÙˆ:</span>
                                        <div style="color: var(--neon-orange); font-weight: bold;" id="daysUntilJuly">-- ÙŠÙˆÙ…</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem;">
                                <button id="resetBalancesBtn" class="btn-neon" style="flex: 1;">
                                    <i data-lucide="rotate-ccw"></i>
                                    Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø©
                                </button>
                                <button id="viewResetHistoryBtn" class="btn-neon" style="flex: 1; background: rgba(0, 212, 255, 0.1); border-color: rgba(0, 212, 255, 0.3);">
                                    <i data-lucide="history"></i>
                                    Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                                </button>
                            </div>
                        </div>
                        
                        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
                        <div class="card-neon" style="padding: 1.5rem; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3 style="color: var(--neon-blue); font-size: 1.1rem;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    <select id="sortColumn" class="input-neon" style="width: 150px;">
                                        <option value="name">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…</option>
                                        <option value="department">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</option>
                                        <option value="regularBalance">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø±ØµÙŠØ¯</option>
                                        <option value="createdAt">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
                                    </select>
                                    <button id="sortDirection" class="btn-neon" style="padding: 0.5rem; width: auto;">
                                        <i data-lucide="arrow-up" id="sortIcon"></i>
                                    </button>
                                    <input type="text" id="searchEmployee" class="input-neon" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù..." style="width: 200px;">
                                </div>
                            </div>
                            
                            <div style="overflow-x: auto;">
                                <table id="employeesTable" style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="border-bottom: 1px solid rgba(0, 212, 255, 0.3);">
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600; width: 60px;">Ø§Ù„ØµÙˆØ±Ø©</th>
                                            <th style="padding: 0.75rem; text-align: right; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø§Ø³Ù…</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ù‚Ø³Ù…</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: 600;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employeesTableBody">
                                        <tr>
                                            <td colspan="8" style="text-align: center; padding: 3rem; color: var(--primary-200);">
                                                <i data-lucide="users" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5;"></i>
                                                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª -->
                            <div id="pagination" class="hidden" style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 1rem;">
                                <button id="prevPage" class="btn-neon" style="padding: 0.5rem 1rem;">
                                    <i data-lucide="chevron-right"></i>
                                    Ø§Ù„Ø³Ø§Ø¨Ù‚
                                </button>
                                <span id="pageInfo" style="color: var(--primary-200); font-size: 0.9rem;">ØµÙØ­Ø© 1 Ù…Ù† 1</span>
                                <button id="nextPage" class="btn-neon" style="padding: 0.5rem 1rem;">
                                    Ø§Ù„ØªØ§Ù„ÙŠ
                                    <i data-lucide="chevron-left"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ø¬Ù„ -->
                    <div id="recordsTab" class="tab-panel hidden">
                        <h2 style="color: var(--neon-blue); margin-bottom: 1.5rem; font-size: 1.5rem;">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø±ÙƒØ§Øª</h2>
                        <div style="text-align: center; padding: 2rem; color: var(--primary-200);">
                            <p>Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <div id="departmentsModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
        <div class="card-neon" style="width: 90%; max-width: 500px; padding: 2rem; border-radius: 12px; max-height: 80vh; overflow-y: auto; position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--neon-blue); font-size: 1.2rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
                <button id="closeDepartmentsModal" style="background: none; border: none; color: var(--neon-red); cursor: pointer; font-size: 1.5rem; padding: 0.5rem;"></button>
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <div id="departmentsNotification"></div>
            
            <!-- Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ -->
            <div style="margin-bottom: 2rem;">
                <h4 style="color: var(--neon-blue); margin-bottom: 1rem;">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</h4>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="newDepartmentName" class="input-neon" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" style="flex: 1;">
                    <button id="addDepartmentBtn" class="btn-neon" style="padding: 0.75rem 1rem;">
                        <i data-lucide="plus"></i>
                        Ø¥Ø¶Ø§ÙØ©
                    </button>
                </div>
            </div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
            <div>
                <h4 style="color: var(--neon-blue); margin-bottom: 1rem;">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                <div id="departmentsList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø© -->
    <div id="resetBalancesModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
        <div class="card-neon" style="width: 90%; max-width: 600px; padding: 2rem; border-radius: 12px; max-height: 80vh; overflow-y: auto; position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--neon-blue); font-size: 1.2rem;">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©</h3>
                <button id="closeResetModal" style="background: none; border: none; color: var(--neon-red); cursor: pointer; font-size: 1.5rem; padding: 0.5rem;">
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <div id="resetNotification"></div>
            
            <div style="background: rgba(255, 235, 59, 0.1); border: 1px solid rgba(255, 235, 59, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                <h4 style="color: var(--neon-yellow); margin-bottom: 0.75rem;">âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h4>
                <p style="color: var(--primary-200); margin-bottom: 0.5rem;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø±ØµØ¯Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†ØŸ</p>
            </div>
            
            <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                <h4 style="color: var(--neon-blue); margin-bottom: 0.75rem;">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <span style="color: var(--primary-200);">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:</span>
                        <span style="color: var(--neon-blue); font-weight: bold;" id="resetEmployeeCount">0 Ù…ÙˆØ¸Ù</span>
                    </div>
                    <div>
                        <span style="color: var(--primary-200);">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</span>
                        <span style="color: var(--neon-green); font-weight: bold;" id="resetNewYear">2025-2026</span>
                    </div>
                    <div>
                        <span style="color: var(--primary-200);">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                        <span style="color: var(--neon-yellow); font-weight: bold;" id="resetDate">1 ÙŠÙˆÙ„ÙŠÙˆ 2025</span>
                    </div>
                    <div>
                        <span style="color: var(--primary-200);">Ø§Ù„Ù…Ù†ÙØ°:</span>
                        <span style="color: var(--neon-orange); font-weight: bold;" id="resetBy">Ø§Ù„Ù…Ø¯ÙŠØ±</span>
                    </div>
                </div>
            </div>
            
            <div style="background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                <h4 style="color: var(--neon-green); margin-bottom: 0.75rem;">âœ… Ø³ÙŠØªÙ…:</h4>
                <ul style="color: var(--primary-200); margin: 0; padding-right: 1.5rem;">
                    <li>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¥Ù„Ù‰ ØµÙØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</li>
                    <li>Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (30 Ø£Ùˆ 45 ÙŠÙˆÙ… Ø­Ø³Ø¨ ÙƒÙ„ Ù…ÙˆØ¸Ù)</li>
                    <li>Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ±</li>
                    <li>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…</li>
                </ul>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button id="confirmResetBtn" class="btn-neon" style="flex: 1; background: linear-gradient(45deg, var(--neon-green), var(--primary-600)); border-color: var(--neon-green);">
                    <i data-lucide="check"></i>
                    ØªØ£ÙƒÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                </button>
                <button id="cancelResetBtn" style="flex: 1; background: rgba(255, 68, 68, 0.2); border: 1px solid rgba(255, 68, 68, 0.5); color: #ff4444; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                    <i data-lucide="x"></i>
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† -->
    <div id="resetHistoryModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; display: flex; align-items: center; justify-content: center;">
        <div class="card-neon" style="width: 90%; max-width: 800px; padding: 2rem; border-radius: 12px; max-height: 80vh; overflow-y: auto; position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--neon-blue); font-size: 1.2rem;">Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø©</h3>
                <button id="closeHistoryModal" style="background: none; border: none; color: var(--neon-red); cursor: pointer; font-size: 1.5rem; padding: 0.5rem;">
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <div id="resetHistoryContent">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
        window.addEventListener('load', function() {
            if (typeof firebase === 'undefined') {
                console.error('Firebase library failed to load');
                alert('Ø®Ø·Ø£: ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Firebase. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                return;
            }
            
            if (typeof lucide === 'undefined') {
                console.error('Lucide library failed to load');
                // ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            }
            
            console.log('All libraries loaded successfully');
        });
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC9uv8kVPNZ4bFLOhut8vfBohJC9754Kl8",
            authDomain: "employee-leave-system-802f2.firebaseapp.com",
            projectId: "employee-leave-system-802f2",
            storageBucket: "employee-leave-system-802f2.firebasestorage.app",
            messagingSenderId: "776392559214",
            appId: "1:776392559214:web:338956b61330b7307ef47f"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ
        let auth, db;
        async function initializeFirebase() {
            try {
                // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Firebase
                const firebaseReady = await window.firebaseLoadingPromise;
                
                if (firebaseReady && typeof firebase !== 'undefined') {
                    console.log('ğŸ”¥ Initializing Firebase...');
                    
                    const firebaseConfig = {
                        apiKey: "AIzaSyC9uv8kVPNZ4bFLOhut8vfBohJC9754Kl8",
                        authDomain: "employee-leave-system-802f2.firebaseapp.com",
                        projectId: "employee-leave-system-802f2",
                        storageBucket: "employee-leave-system-802f2.firebasestorage.app",
                        messagingSenderId: "776392559214",
                        appId: "1:776392559214:web:338956b61330b7307ef47f"
                    };

                    firebase.initializeApp(firebaseConfig);
                    auth = firebase.auth();
                    db = firebase.firestore();
                    
                    console.log('âœ… Firebase initialized successfully');
                    return true;
                } else {
                    console.warn('âš ï¸ Firebase not available, using local mode');
                    return false;
                }
            } catch (error) {
                console.error('âŒ Firebase initialization error:', error);
                return false;
            }
        }

        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentUser = null;
        let employees = [];
        let leaveRecords = [];

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        let forgetPasswordCount = parseInt(localStorage.getItem('forgetPasswordCount') || '0');
        
        // Ø±Ø³Ø§Ø¦Ù„ Ù†Ø³ÙŠØ§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ÙƒÙˆÙ…ÙŠØ¯ÙŠØ©
        const forgotPasswordMessages = [
            {
                emoji: "ğŸ˜ ",
                text: "Ù†Ø³ÙŠØª ØªØ§ÙƒÙ„! Ù†Ø³ÙŠØª ØªØ´Ø±Ø¨! Ù†Ø³ÙŠØª ØªØºØªØª Ø¹Ù„Ù‰ Ø²Ù…Ø§ÙŠÙ„Ùƒ!"
            },
            {
                emoji: "ğŸ¤”", 
                text: "Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù…Ù„ÙŠØ§Ù†Ø©! .. Ø§Ù…Ø³Ø­ Ø´ÙˆÙŠØ© Ù…Ù† Ø°ÙƒØ±ÙŠØ§ØªÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©"
            },
            {
                emoji: "ğŸ˜‚",
                text: "Ù…Ø§ Ø³ÙŠØ§Ø¯ØªÙƒ Ù„Ùˆ Ù…Ø±ÙƒØ² .. Ù…Ø§ÙƒÙ†ØªØ´ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
            }
        ];

        // Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ©
        const seasonalMessages = {
            // Ø±Ø³Ø§Ø¦Ù„ ÙŠÙˆÙ…ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
            morning: [
                "ï¿½ ØµØ¨Ø§Ø³Ø­ Ø§Ù„Ø®ÙŠØ±! Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ ÙŠÙˆÙ…Ø§Ù‹ Ù…Ø«Ù…Ø±Ø§Ù‹ ÙˆÙ…Ù„ÙŠØ¦Ø§Ù‹ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª",
                "â˜€ï¸ ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±! Ø¨Ø¯Ø§ÙŠØ© Ù…ÙˆÙÙ‚Ø© Ù„ÙŠÙˆÙ… Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯",
                "ğŸŒ Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! ØµØ¨Ø§Ø­ Ù…Ø¨Ø§Ø±Ùƒ ÙˆØ¹Ù…Ù„ Ù…Ù…ØªØ¹"
            ],
            afternoon: [
                "ğŸŒ¤ï¸ Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±! Ù†ØªÙ…Ù†Ù‰ Ø£Ù† ÙŠÙƒÙˆÙ† ÙŠÙˆÙ…Ùƒ Ù…Ø«Ù…Ø±Ø§Ù‹",
                "ï¿½ Ù…Ø³Ø§Ø¡ Ø§ÙƒÙ„Ù†ÙˆØ±! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø§Ø¦Ø¹",
                "âœ¨ Ù…Ø³Ø§Ø¡ Ù…Ø¨Ø§Ø±Ùƒ! Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¬Ù‡ÙˆØ¯Ùƒ Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø©"
            ],
            evening: [
                "ğŸŒ™ Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±! ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ ÙŠÙˆÙ… Ø¹Ù…Ù„ Ù†Ø§Ø¬Ø­",
                "â­ Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±! Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¹Ø·Ø§Ø¦Ùƒ Ø§Ù„ÙŠÙˆÙ…",
                "ï¿½  Ù…Ø³Ø§Ø¡ Ù…Ø¨Ø§Ø±Ùƒ! Ø§Ø³ØªØ±Ø­ Ø¬ÙŠØ¯Ø§Ù‹ Ù„ØªØ³ØªØ¹Ø¯ Ù„ØºØ¯ Ø£ÙØ¶Ù„"
            ],
            
            // Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª ÙˆØ§Ù„Ø£Ø¹ÙŠØ§Ø¯ Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©
            newYear: [
                "ğŸŠ ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ±! Ø¹Ø§Ù… Ø¬Ø¯ÙŠØ¯ Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„ØªÙˆÙÙŠÙ‚",
                "âœ¨ Ø£Ø¹Ø§Ø¯Ù‡ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ†Ø§ ÙˆØ¹Ù„ÙŠÙƒÙ… Ø¨Ø§Ù„Ø®ÙŠØ± ÙˆØ§Ù„ÙŠÙ…Ù† ÙˆØ§Ù„Ø¨Ø±ÙƒØ§Øª"
            ],
            
            ramadan: [
                "ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ùƒ! ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ± ÙˆØµØ­Ø© ÙˆØ³Ù„Ø§Ù…Ø©",
                "ğŸ•Œ Ø£Ù‡Ù„Ø§Ù‹ Ø±Ù…Ø¶Ø§Ù†! Ø´Ù‡Ø± Ø§Ù„Ø®ÙŠØ± ÙˆØ§Ù„Ø¨Ø±ÙƒØ© ÙˆØ§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­"
            ],
            
            eidFitr: [
                "ğŸ† Ø¹ÙŠØ¯ ÙØ·Ø± Ù…Ø¨Ø§Ø±Ùƒ! ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ± ÙˆØ³Ø¹Ø§Ø¯Ø©",
                "ğŸŒŸ ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ…! Ø¹ÙŠØ¯ Ø³Ø¹ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù…ÙŠØ¹"
            ],
            
            eidAdha: [
                "ï¿½  Ø¹ÙŠØ¯ Ø£Ø¶Ø­Ù‰ Ù…Ø¨Ø§Ø±Ùƒ! ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ± ÙˆØµØ­Ø©",
                "ğŸŠ ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„! Ø¹ÙŠØ¯ Ø³Ø¹ÙŠØ¯"
            ],
            
            // Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©
            nationalDay: [
                "ğŸ‡ªğŸ‡¬ ÙƒÙ„ Ø¹Ø§Ù… ÙˆÙ…ØµØ± Ø¨Ø®ÙŠØ±! Ø¹ÙŠØ¯ ÙˆØ·Ù†ÙŠ Ø³Ø¹ÙŠØ¯",
                "ğŸ–ï¸ Ù…Ø¨Ø§Ø±Ùƒ Ù„Ù„ÙˆØ·Ù† Ø§Ù„ØºØ§Ù„ÙŠ! ÙƒÙ„ Ø¹Ø§Ù… ÙˆÙ…ØµØ± Ø£Ù‚ÙˆÙ‰ ÙˆØ£Ø¹Ø²"
            ],
            
            sinaiLiberation: [
                "ğŸ‡ªğŸ‡¬ Ø°ÙƒØ±Ù‰ ØªØ­Ø±ÙŠØ± Ø³ÙŠÙ†Ø§Ø¡! ÙƒÙ„ Ø¹Ø§Ù… ÙˆÙ…ØµØ± Ø­Ø±Ø© Ø£Ø¨ÙŠØ©",
                "ğŸ–ï¸ ØªØ­ÙŠØ© Ù„Ø£Ø¨Ø·Ø§Ù„ Ù…ØµØ±! Ø°ÙƒØ±Ù‰ Ø¹Ø²ÙŠØ²Ø© Ø¹Ù„Ù‰ Ù‚Ù„ÙˆØ¨Ù†Ø§"
            ],
            
            revolution25: [
                "ğŸ‡ªğŸ‡¬ Ø°ÙƒØ±Ù‰ Ø«ÙˆØ±Ø© 25 ÙŠÙ†Ø§ÙŠØ±! ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ§Ù„Ø´Ø¹Ø¨ Ø§Ù„Ù…ØµØ±ÙŠ Ø¨Ø®ÙŠØ±",
                "âœŠ ØªØ­ÙŠØ© Ù„Ù„Ø¥Ø±Ø§Ø¯Ø© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©! Ù…ØµØ± Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©"
            ],
            
            policeDay: [
                "ğŸ‘®â€â™‚ï¸ Ø¹ÙŠØ¯ Ø§Ù„Ø´Ø±Ø·Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©! ØªØ­ÙŠØ© Ù„Ø±Ø¬Ø§Ù„ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø£Ø¨Ø·Ø§Ù„",
                "ğŸ–ï¸ ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ±Ø¬Ø§Ù„ Ø§Ù„Ø´Ø±Ø·Ø© Ø¨Ø®ÙŠØ± ÙˆØ¹Ø§ÙÙŠØ©"
            ]
        };

        // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
        function getSeasonalMessageType() {
            const now = new Date();
            const month = now.getMonth() + 1; // 1-12
            const day = now.getDate();
            const hour = now.getHours();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            if ((month === 12 && day >= 31) || (month === 1 && day <= 2)) {
                return 'newYear';
            }
            
            // Ø±Ù…Ø¶Ø§Ù† (ØªÙ‚Ø±ÙŠØ¨ÙŠ - ÙŠØªØºÙŠØ± ÙƒÙ„ Ø³Ù†Ø©)
            if (month === 3 || month === 4) {
                return 'ramadan';
            }
            
            // Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
            if (month === 4 || month === 5) {
                return 'eidFitr';
            }
            
            // Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
            if (month === 7 || month === 8) {
                return 'eidAdha';
            }
            
            // Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©
            if (month === 1 && day === 25) {
                return 'revolution25';
            }
            
            if (month === 4 && day === 25) {
                return 'sinaiLiberation';
            }
            
            if (month === 7 && day === 23) {
                return 'nationalDay';
            }
            
            if (month === 1 && day === 25) {
                return 'policeDay';
            }
            
            // Ø±Ø³Ø§Ø¦Ù„ ÙŠÙˆÙ…ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª
            if (hour >= 5 && hour < 12) {
                return 'morning';
            } else if (hour >= 12 && hour < 17) {
                return 'afternoon';
            } else {
                return 'evening';
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ© (ÙÙ‚Ø· Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)
        function showSeasonalMessage() {
            const messageType = getSeasonalMessageType();
            
            if (messageType && seasonalMessages[messageType]) {
                const messages = seasonalMessages[messageType];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                
                const messageElement = document.getElementById('seasonalMessage');
                const contentElement = document.getElementById('seasonalMessageContent');
                
                contentElement.textContent = randomMessage;
                messageElement.classList.add('show');
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†
                setTimeout(() => {
                    messageElement.classList.remove('show');
                }, 4000);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©
        function closeSeasonalMessage() {
            document.getElementById('seasonalMessage').classList.remove('show');
        }

        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ù†Ø³ÙŠØ§Ù† ÙƒÙ„ï¿½ï¿½Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function showForgotPasswordModal() {
            // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
            forgetPasswordCount++;
            localStorage.setItem('forgetPasswordCount', forgetPasswordCount.toString());
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø±Ø³Ø§Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            const randomMessage = forgotPasswordMessages[Math.floor(Math.random() * forgotPasswordMessages.length)];
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù…Ø¹ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³ÙŠØ§Ù†
            const messageElement = document.getElementById('forgotPasswordMessage');
            messageElement.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">${randomMessage.emoji}</div>
                <div>${randomMessage.text}</div>
                ${showForgetCounterInModal()}
            `;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById('forgotPasswordModal').classList.add('show');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ù†Ø³ÙŠØ§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function closeForgotPasswordModal() {
            document.getElementById('forgotPasswordModal').classList.remove('show');
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³ÙŠØ§Ù† (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©)
        function updateForgetCounter() {
            // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            return;
        }

        // Ø¹Ø±Ø¶ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³ÙŠØ§Ù† ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function showForgetCounterInModal() {
            if (forgetPasswordCount > 0) {
                let message = '';
                
                if (forgetPasswordCount === 1) {
                    message = "ï¿½â€ Ø£ÙˆÙ„ Ù…Ø±Ø© ØªÙ†Ø³Ù‰ØŸ Ø¹Ø§Ø¯ÙŠ ÙŠØ­ØµÙ„";
                } else if (forgetPasswordCount <= 3) {
                    message = `ï¿½  Ø§Ù„Ù…Ø±Ø© Ø±Ù‚Ù… ${forgetPasswordCount}! Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù…Ø­ØªØ§Ø¬Ø© ÙÙŠØªØ§Ù…ÙŠÙ†!`;
                } else if (forgetPasswordCount <= 5) {
                    message = `ğŸ¤¦â€â™‚ï¸ Ø§Ù„Ù…Ø±Ø© Ø¯ÙŠ Ø±Ù‚Ù… ${forgetPasswordCount}! Ø¥Ù†Øª Ù…Ø­ØªØ§Ø¬ Ù…ÙÙƒØ±Ø©`;
                } else if (forgetPasswordCount <= 10) {
                    message = `ğŸ˜‚ ${forgetPasswordCount} Ù…Ø±Ø§Øª! Ø¥Ù†Øª Ø¨Ø·Ù„ Ø§Ù„Ù†Ø³ÙŠØ§Ù† Ø§Ù„Ø±Ø³Ù…ÙŠ`;
                } else {
                    message = `ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! Ø¥Ù†Øª ÙˆØµÙ„Øª Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„Ù†Ø³ÙŠØ§Ù† (${forgetPasswordCount} Ù…Ø±Ø©)`;
                }
                
                return `<div style="margin-top: 1rem; padding: 0.5rem; background: rgba(255, 235, 59, 0.1); border: 1px solid rgba(255, 235, 59, 0.3); border-radius: 8px; font-size: 0.9rem; color: var(--neon-yellow);">${message}</div>`;
            }
            return '';
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function resetPassword() {
            closeForgotPasswordModal();
            
            // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const resetModal = document.createElement('div');
            resetModal.className = 'modal-overlay show';
            resetModal.innerHTML = `
                <div class="modal-content">
                    <h2 class="modal-title">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
                    <div class="modal-message">
                        <p>Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±:</p>
                        <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 8px; padding: 1rem; margin: 1rem 0;">
                            <p><strong>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> admin@company.com</p>
                            <p><strong>ğŸ“± Ø§Ù„Ù‡Ø§ØªÙ:</strong> 01234567890</p>
                            <p><strong>ğŸ’¬ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</strong> 01234567890</p>
                        </div>
                        <p style="font-size: 0.9rem; color: var(--primary-200);">Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-btn primary" onclick="closeResetModal()">ÙÙ‡Ù…ØªØŒ Ø´ÙƒØ±Ø§Ù‹ ğŸ‘</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(resetModal);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
            resetModal.addEventListener('click', function(e) {
                if (e.target === resetModal) {
                    closeResetModal();
                }
            });
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function closeResetModal() {
            const resetModal = document.querySelector('.modal-overlay:last-child');
            if (resetModal) {
                resetModal.remove();
            }
        }

        // Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
        function saveLoginData() {
            if (document.getElementById('rememberMe').checked) {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                localStorage.setItem('rememberedEmail', email);
                localStorage.setItem('rememberedPassword', btoa(password)); // ØªØ´ÙÙŠØ± Ø¨Ø³ÙŠØ·
                localStorage.setItem('rememberMe', 'true');
            } else {
                localStorage.removeItem('rememberedEmail');
                localStorage.removeItem('rememberedPassword');
                localStorage.removeItem('rememberMe');
            }
        }

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function loadSavedLoginData() {
            if (localStorage.getItem('rememberMe') === 'true') {
                const email = localStorage.getItem('rememberedEmail');
                const password = localStorage.getItem('rememberedPassword');
                
                if (email) document.getElementById('loginEmail').value = email;
                if (password) document.getElementById('loginPassword').value = atob(password); // ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±
                document.getElementById('rememberMe').checked = true;
            }
            
            // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø³ÙŠØ§Ù† ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        }
        let saturdayShifts = [];
        let currentAttendance = []; // Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹
        let selectedLeaveType = 'regular';
        let editingEmployeeId = null; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù‚ÙŠØ¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        let filteredEmployees = []; // Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…ÙÙ„ØªØ±ÙŠÙ†
        let resetHistory = []; // Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø©
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ… ÙˆØ§Ù„ØªØ±ØªÙŠØ¨
        let currentPage = 1;
        let employeesPerPage = 30;
        let sortColumn = 'name';
        let sortDirection = 'asc'; // asc Ø£Ùˆ desc
        let departments = ['ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©', 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©']; // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©

        // ==================== Real-time Synchronization System ====================
        let realtimeListeners = []; // Ù…ØµÙÙˆÙØ© Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
        let isRealtimeEnabled = false; // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
        let realtimeStatus = 'disconnected'; // Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: connected, disconnected, error

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
        function refreshIcons() {
            try {
                // Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯Ù…Ø¬ ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹
                lucide.createIcons();
            } catch (error) {
                console.warn('âš ï¸ Icon refresh failed:', error);
            }
        }

        // ==================== Real-time Synchronization Functions ====================
        
        // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
        function initializeRealtimeSync() {
            if (typeof firebase === 'undefined' || !db) {
                console.warn('âš ï¸ Firebase not available - Real-time sync disabled');
                return false;
            }

            try {
                console.log('ğŸ”„ Initializing real-time synchronization...');
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ†
                cleanupRealtimeListeners();
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
                setupEmployeesListener();
                setupLeaveRecordsListener();
                setupSaturdayShiftsListener();
                setupCurrentAttendanceListener();
                setupResetHistoryListener();
                setupDepartmentsListener();
                
                isRealtimeEnabled = true;
                realtimeStatus = 'connected';
                console.log('âœ… Real-time synchronization enabled');
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                showRealtimeStatus('connected');
                
                return true;
            } catch (error) {
                console.error('âŒ Failed to initialize real-time sync:', error);
                realtimeStatus = 'error';
                showRealtimeStatus('error');
                return false;
            }
        }

        // ØªÙ†Ø¸ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
        function cleanupRealtimeListeners() {
            console.log('ğŸ§¹ Cleaning up real-time listeners...');
            realtimeListeners.forEach(unsubscribe => {
                if (typeof unsubscribe === 'function') {
                    unsubscribe();
                }
            });
            realtimeListeners = [];
        }

        // Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function setupEmployeesListener() {
            const unsubscribe = db.collection('employees').onSnapshot(
                (snapshot) => {
                    console.log('ğŸ“Š Employees data updated');
                    
                    const newEmployees = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    employees = newEmployees;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    updateEmployeesUI();
                },
                (error) => {
                    console.error('âŒ Employees listener error:', error);
                    handleRealtimeError('employees', error);
                }
            );
            
            realtimeListeners.push(unsubscribe);
        }

        // Ù…Ø³ØªÙ…Ø¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
        function setupLeaveRecordsListener() {
            const unsubscribe = db.collection('leave_records').onSnapshot(
                (snapshot) => {
                    console.log('ğŸ“ Leave records updated');
                    
                    const newRecords = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    leaveRecords = newRecords;
                    updateLeaveRecordsUI();
                },
                (error) => {
                    console.error('âŒ Leave records listener error:', error);
                    handleRealtimeError('leave_records', error);
                }
            );
            
            realtimeListeners.push(unsubscribe);
        }

        // Ù…Ø³ØªÙ…Ø¹ Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª
        function setupSaturdayShiftsListener() {
            const unsubscribe = db.collection('saturday_shifts').onSnapshot(
                (snapshot) => {
                    console.log('â° Saturday shifts updated');
                    
                    const newShifts = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    saturdayShifts = newShifts;
                    updateSaturdayShiftsUI();
                },
                (error) => {
                    console.error('âŒ Saturday shifts listener error:', error);
                    handleRealtimeError('saturday_shifts', error);
                }
            );
            
            realtimeListeners.push(unsubscribe);
        }

        // Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
        function setupCurrentAttendanceListener() {
            const unsubscribe = db.collection('current_attendance').onSnapshot(
                (snapshot) => {
                    console.log('ğŸ‘¥ Current attendance updated');
                    
                    const newAttendance = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    currentAttendance = newAttendance;
                    updateCurrentAttendeesUI();
                },
                (error) => {
                    console.error('âŒ Current attendance listener error:', error);
                    handleRealtimeError('current_attendance', error);
                }
            );
            
            realtimeListeners.push(unsubscribe);
        }

        // Ù…Ø³ØªÙ…Ø¹ Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function setupResetHistoryListener() {
            const unsubscribe = db.collection('reset_history').orderBy('resetDate', 'desc').onSnapshot(
                (snapshot) => {
                    console.log('ğŸ”„ Reset history updated');
                    
                    const newHistory = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    resetHistory = newHistory;
                    updateResetInfo();
                },
                (error) => {
                    console.error('âŒ Reset history listener error:', error);
                    handleRealtimeError('reset_history', error);
                }
            );
            
            realtimeListeners.push(unsubscribe);
        }

        // Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function setupDepartmentsListener() {
            const unsubscribe = db.collection('departments').onSnapshot(
                (snapshot) => {
                    console.log('ğŸ¢ Departments updated');
                    
                    if (!snapshot.empty) {
                        departments = snapshot.docs.map(doc => doc.data().name);
                        updateDepartmentSelects();
                    }
                },
                (error) => {
                    console.error('âŒ Departments listener error:', error);
                    handleRealtimeError('departments', error);
                }
            );
            
            realtimeListeners.push(unsubscribe);
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function updateEmployeesUI() {
            try {
                // ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø±ØµØ¯Ø©
                updateBalancesView();
                
                // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                loadEmployeeOptions();
                
                // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                filterEmployees();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateEmployeeStats();
                updateMainStats();
                
                console.log('âœ… Employees UI updated');
            } catch (error) {
                console.error('âŒ Error updating employees UI:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
        function updateLeaveRecordsUI() {
            try {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                updateMainStats();
                
                // ØªØ­Ø¯ÙŠØ« Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ù‚Ø¯ ØªØªØ£Ø«Ø± Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
                updateBalancesView();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù…ÙØªÙˆØ­Ø§Ù‹
                const recordsTab = document.getElementById('recordsTab');
                if (recordsTab && !recordsTab.classList.contains('hidden')) {
                    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù‡Ù†Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                }
                
                console.log('âœ… Leave records UI updated');
            } catch (error) {
                console.error('âŒ Error updating leave records UI:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª
        function updateSaturdayShiftsUI() {
            try {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateMainStats();
                
                // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹
                const saturdayTab = document.getElementById('saturdayTab');
                if (saturdayTab && !saturdayTab.classList.contains('hidden')) {
                    // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª
                    updateSaturdayTable();
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
                    updateCurrentAttendees();
                    updateTodayAttendees();
                }
                
                console.log('âœ… Saturday shifts UI updated');
            } catch (error) {
                console.error('âŒ Error updating Saturday shifts UI:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
        function updateCurrentAttendeesUI() {
            try {
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†
                updateTodayAttendees();
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                updateCurrentAttendees();
                
                console.log('âœ… Current attendees UI updated');
            } catch (error) {
                console.error('âŒ Error updating current attendees UI:', error);
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Real-time
        function handleRealtimeError(collection, error) {
            console.error(`âŒ Real-time error in ${collection}:`, error);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            realtimeStatus = 'error';
            showRealtimeStatus('error');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const errorMessage = `Ø®Ø·Ø£ ÙÙŠ ØªØ²Ø§Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª ${collection}. Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.`;
            console.warn(errorMessage);
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                if (isRealtimeEnabled) {
                    console.log(`ğŸ”„ Retrying connection for ${collection}...`);
                    showRealtimeStatus('reconnecting');
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
                    setTimeout(() => {
                        initializeRealtimeSync();
                    }, 1000);
                }
            }, 5000);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
        function showRealtimeStatus(status) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
            const existingIndicator = document.getElementById('realtimeIndicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¤Ø´Ø± Ø¬Ø¯ÙŠØ¯
            const indicator = document.createElement('div');
            indicator.id = 'realtimeIndicator';
            indicator.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: bold;
                z-index: 1000;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            `;

            let statusText, statusColor, statusIcon;
            
            switch (status) {
                case 'connected':
                    statusText = 'Ù…ØªØ²Ø§Ù…Ù† ÙÙˆØ±ÙŠØ§Ù‹';
                    statusColor = 'var(--neon-green)';
                    statusIcon = 'ğŸŸ¢';
                    break;
                case 'disconnected':
                    statusText = 'ØºÙŠØ± Ù…ØªØµÙ„';
                    statusColor = 'var(--neon-yellow)';
                    statusIcon = 'ğŸŸ¡';
                    break;
                case 'error':
                    statusText = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
                    statusColor = 'var(--neon-red)';
                    statusIcon = 'ğŸ”´';
                    break;
                case 'reconnecting':
                    statusText = 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...';
                    statusColor = 'var(--neon-blue)';
                    statusIcon = 'ğŸ”„';
                    break;
                default:
                    return;
            }

            indicator.style.background = `rgba(0, 35, 102, 0.9)`;
            indicator.style.border = `1px solid ${statusColor}`;
            indicator.style.color = statusColor;
            indicator.innerHTML = `${statusIcon} ${statusText}`;

            document.body.appendChild(indicator);

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù† Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„
            if (status === 'connected') {
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.style.opacity = '0';
                        setTimeout(() => {
                            if (indicator.parentNode) {
                                indicator.remove();
                            }
                        }, 300);
                    }
                }, 3000);
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
        function testRealtimeSync() {
            console.log('ğŸ§ª Testing real-time synchronization...');
            
            if (!isRealtimeEnabled) {
                console.warn('âš ï¸ Real-time sync is not enabled');
                return false;
            }
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase
            if (typeof firebase === 'undefined' || !db) {
                console.error('âŒ Firebase not available for real-time sync');
                return false;
            }
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
            const expectedListeners = 6; // employees, leave_records, saturday_shifts, current_attendance, reset_history, departments
            if (realtimeListeners.length !== expectedListeners) {
                console.warn(`âš ï¸ Expected ${expectedListeners} listeners, but found ${realtimeListeners.length}`);
            }
            
            console.log(`âœ… Real-time sync test passed - ${realtimeListeners.length} listeners active`);
            console.log('ğŸ“Š Real-time status:', realtimeStatus);
            console.log('ğŸ”— Active listeners:', realtimeListeners.length);
            
            return true;
        }

        // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        window.testRealtime = function() {
            console.log('=== Real-time Synchronization Test ===');
            console.log('ğŸ” Current user:', currentUser?.email || 'Not logged in');
            console.log('ğŸ”¥ Firebase available:', typeof firebase !== 'undefined');
            console.log('ğŸ’¾ Database available:', !!db);
            console.log('âš¡ Real-time enabled:', isRealtimeEnabled);
            console.log('ğŸ“¡ Connection status:', realtimeStatus);
            console.log('ğŸ‘‚ Active listeners:', realtimeListeners.length);
            
            if (isRealtimeEnabled) {
                console.log('âœ… Real-time synchronization is working!');
                console.log('ğŸ’¡ Try opening the system in another browser tab to test multi-user sync');
            } else {
                console.log('âŒ Real-time synchronization is not active');
                console.log('ğŸ’¡ Make sure you are logged in and Firebase is connected');
            }
            
            return {
                enabled: isRealtimeEnabled,
                status: realtimeStatus,
                listeners: realtimeListeners.length,
                firebase: typeof firebase !== 'undefined',
                database: !!db,
                user: currentUser?.email
            };
        };

        // Ø­Ø³Ø§Ø¨Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ
        const testAccounts = {
            'admin@company.com': { password: 'admin123', role: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…' },
            'supervisor@company.com': { password: 'super123', role: 'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø£ÙˆÙ„' },
            'employee@company.com': { password: 'emp123', role: 'Ù…ÙˆØ¸Ù ØªØ¬Ø±ÙŠØ¨ÙŠ' }
        };

        // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
        const usernames = {
            'admin': { email: 'admin@company.com', password: 'admin123', role: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…' },
            'supervisor': { email: 'supervisor@company.com', password: 'super123', role: 'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø£ÙˆÙ„' },
            'employee': { email: 'employee@company.com', password: 'emp123', role: 'Ù…ÙˆØ¸Ù ØªØ¬Ø±ÙŠØ¨ÙŠ' },
            'Ù…Ø¯ÙŠØ±': { email: 'admin@company.com', password: 'admin123', role: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…' },
            'Ù…Ø´Ø±Ù': { email: 'supervisor@company.com', password: 'super123', role: 'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø£ÙˆÙ„' },
            'Ù…ÙˆØ¸Ù': { email: 'employee@company.com', password: 'emp123', role: 'Ù…ÙˆØ¸Ù ØªØ¬Ø±ÙŠØ¨ÙŠ' }
        };

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            
            // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
            setTimeout(() => {
                initializeApp();
            }, 500);
        });

        async function initializeApp() {
            try {
                console.log('ğŸš€ Initializing application...');
                
                // ØªÙ‡ÙŠØ¦Ø© Firebase
                const firebaseReady = await initializeFirebase();
                
                // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª (Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯Ù…Ø¬ ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹)
                console.log('ğŸ¨ Initializing icon system...');
                lucide.createIcons();
                console.log('âœ… Icon system initialized');
                
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                loadSavedLoginData();
                console.log('âœ… Saved login data loaded');
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                setupEvents();
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                setupAuthStateListener(firebaseReady);
                
                console.log('âœ… Application initialized successfully');
                
            } catch (error) {
                console.error('âŒ App initialization error:', error);
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù…Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
                console.log('ğŸ”„ Attempting minimal initialization...');
                lucide.createIcons();
                loadSavedLoginData();
                setupEvents();
                showLoginScreen();
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        function setupAuthStateListener(firebaseReady) {
            if (firebaseReady && auth) {
                console.log('ğŸ” Setting up Firebase auth listener...');
                auth.onAuthStateChanged((user) => {
                    try {
                        if (user) {
                            console.log('ğŸ‘¤ Firebase user logged in:', user.email);
                            currentUser = {
                                email: user.email,
                                role: testAccounts[user.email]?.role || 'Ù…Ø³ØªØ®Ø¯Ù…'
                            };
                            showMainScreen();
                            loadData();
                        } else {
                            console.log('ğŸ‘‹ Firebase user logged out');
                            if (!currentUser) {
                                showLoginScreen();
                            }
                        }
                    } catch (error) {
                        console.error('âŒ Auth state change error:', error);
                        showLoginScreen();
                    }
                });
            } else {
                console.log('ğŸ  Using local authentication mode');
                showLoginScreen();
            }
        }

        function setupEvents() {
            console.log('Setting up events...');
            
            // ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ - Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø§Ù„Ù„Ù…Ø³
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                console.log('ğŸ“± Mobile device detected - enabling touch optimizations');
                
                // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
                document.addEventListener('touchstart', function() {}, { passive: true });
                document.addEventListener('touchmove', function() {}, { passive: true });
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('Login form event listener added');
            } else {
                console.error('Login form not found');
            }
            
            // Ø±Ø§Ø¨Ø· Ù†Ø³ÙŠØ§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            if (forgotPasswordLink) {
                forgotPasswordLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showForgotPasswordModal();
                });
                console.log('Forgot password link event listener added');
            }
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
            const rememberMeCheckbox = document.getElementById('rememberMe');
            if (rememberMeCheckbox) {
                rememberMeCheckbox.addEventListener('change', function() {
                    if (!this.checked) {
                        localStorage.removeItem('rememberedEmail');
                        localStorage.removeItem('rememberedPassword');
                        localStorage.removeItem('rememberMe');
                    }
                });
            }
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal-overlay')) {
                    e.target.classList.remove('show');
                }
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
                console.log('Logout button event listener added');
            } else {
                console.warn('Logout button not found');
            }
            
            // Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('tab-button') || e.target.closest('.tab-button')) {
                    const button = e.target.classList.contains('tab-button') ? e.target : e.target.closest('.tab-button');
                    const tabName = button.dataset.tab;
                    switchTab(tabName);
                }
            });
            
            // Ø£Ø²Ø±Ø§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('leave-type-btn')) {
                    selectLeaveType(e.target);
                }
            });
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆØ¸Ù
            document.addEventListener('change', function(e) {
                if (e.target.id === 'recordEmployee') {
                    showEmployeeBalance();
                }
                if (['startDate', 'endDate', 'startTime', 'endTime'].includes(e.target.id)) {
                    calculateDuration();
                }
                if (['arrivalTime', 'departureTime'].includes(e.target.id)) {
                    calculateSaturdayHours();
                }
                if (e.target.id === 'attendanceEmployee') {
                    updateAttendanceButton();
                }
            });
            
            // Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©
            document.addEventListener('submit', function(e) {
                if (e.target.id === 'recordForm') {
                    e.preventDefault();
                    handleRecordSubmit();
                }
                if (e.target.id === 'saturdayForm') {
                    e.preventDefault();
                    handleSaturdaySubmit();
                }
                if (e.target.id === 'saturdayAttendanceForm') {
                    e.preventDefault();
                    handleAttendanceSubmit();
                }
                if (e.target.id === 'employeeForm') {
                    e.preventDefault();
                    handleEmployeeSubmit();
                }
            });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø¥Ø¶Ø§ÙÙŠØ©
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('edit-employee-btn')) {
                    editEmployee(e.target.dataset.employeeId);
                }
                if (e.target.classList.contains('delete-employee-btn')) {
                    deleteEmployee(e.target.dataset.employeeId);
                }
                if (e.target.id === 'cancelEmployeeBtn') {
                    cancelEmployeeEdit();
                }
                if (e.target.id === 'sortDirection' || e.target.closest('#sortDirection')) {
                    toggleSortDirection();
                }
                if (e.target.id === 'prevPage') {
                    changePage(-1);
                }
                if (e.target.id === 'nextPage') {
                    changePage(1);
                }
                if (e.target.id === 'manageDepartmentsBtn') {
                    openDepartmentsModal();
                }
                if (e.target.id === 'closeDepartmentsModal') {
                    closeDepartmentsModal();
                }
                if (e.target.id === 'addDepartmentBtn') {
                    addDepartment();
                }
                if (e.target.classList.contains('delete-department-btn')) {
                    deleteDepartment(e.target.dataset.department);
                }
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
                if (e.target.id === 'departmentsModal') {
                    closeDepartmentsModal();
                }
                
                // Ø£Ø²Ø±Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø©
                if (e.target.id === 'resetBalancesBtn') {
                    openResetBalancesModal();
                }
                if (e.target.id === 'viewResetHistoryBtn') {
                    openResetHistoryModal();
                }
                if (e.target.id === 'confirmResetBtn') {
                    executeResetBalances();
                }
                if (e.target.id === 'cancelResetBtn') {
                    closeResetBalancesModal();
                }
                if (e.target.id === 'closeResetModal') {
                    closeResetBalancesModal();
                }
                if (e.target.id === 'closeHistoryModal') {
                    closeResetHistoryModal();
                }
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
                if (e.target.id === 'resetBalancesModal') {
                    closeResetBalancesModal();
                }
                if (e.target.id === 'resetHistoryModal') {
                    closeResetHistoryModal();
                }
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©
            document.addEventListener('input', function(e) {
                if (e.target.id === 'searchEmployee') {
                    currentPage = 1;
                    filterEmployees();
                }
            });
            
            document.addEventListener('change', function(e) {
                if (e.target.id === 'departmentFilter') {
                    currentPage = 1;
                    filterEmployees();
                }
                if (e.target.id === 'sortColumn') {
                    sortColumn = e.target.value;
                    currentPage = 1;
                    filterEmployees();
                }
                if (e.target.id === 'employeePhoto') {
                    handlePhotoPreview(e.target);
                }
            });
        }

        async function loadData() {
            try {
                if (typeof firebase !== 'undefined' && db) {
                    console.log('ğŸ”„ Loading data with real-time synchronization...');
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
                    const realtimeSuccess = initializeRealtimeSync();
                    
                    if (realtimeSuccess) {
                        console.log('âœ… Real-time sync enabled - data will update automatically');
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ)
                        await loadInitialData();
                        
                        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
                        setTimeout(() => {
                            testRealtimeSync();
                        }, 2000);
                    } else {
                        console.warn('âš ï¸ Real-time sync failed, falling back to static loading');
                        await loadStaticData();
                    }
                } else {
                    console.warn('âš ï¸ Firebase not available, using local test data');
                    loadTestData();
                }
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                await loadDepartments();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
                updateAllUI();
                
            } catch (error) {
                console.error('âŒ Error loading data:', error);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                loadTestData();
                updateAllUI();
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© (Ù„Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ)
        async function loadInitialData() {
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                // Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙˆÙ† Ø³ÙŠØªÙˆÙ„ÙˆÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù„Ø§Ø­Ù‚Ø©
                console.log('ğŸ“Š Loading initial data...');
                
                // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ ØªØ­Ù…ÙŠÙ„ Ù…ÙØµÙ„ Ù‡Ù†Ø§ Ù„Ø£Ù† Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø³ÙŠÙ‚ÙˆÙ…ÙˆÙ† Ø¨Ø°Ù„Ùƒ
                // ÙÙ‚Ø· Ù†ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                
            } catch (error) {
                console.error('âŒ Error loading initial data:', error);
                throw error;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© (fallback)
        async function loadStaticData() {
            try {
                console.log('ğŸ“Š Loading static data...');
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ù† Firebase
                const employeesSnapshot = await db.collection('employees').get();
                employees = employeesSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('Loaded employees:', employees);
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                const recordsSnapshot = await db.collection('leave_records').get();
                leaveRecords = recordsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('Loaded records:', leaveRecords);
                
                // ØªØ­Ù…ÙŠÙ„ Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª
                const saturdaySnapshot = await db.collection('saturday_shifts').get();
                saturdayShifts = saturdaySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('Loaded saturday shifts:', saturdayShifts);
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
                const attendanceSnapshot = await db.collection('current_attendance').get();
                currentAttendance = attendanceSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('Loaded current attendance:', currentAttendance);
                
                // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                await loadResetHistory();
                
            } catch (error) {
                console.error('âŒ Error loading static data:', error);
                throw error;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateAllUI() {
            try {
                console.log('ğŸ¨ Updating all UI components...');
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø±ØµØ¯Ø©
                updateBalancesView();
                
                // ØªØ­Ù…ÙŠÙ„ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                loadEmployeeOptions();
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                updateResetInfo();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                checkResetAlerts();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†
                updateCurrentDate();
                updateTodayAttendees();
                updateCurrentAttendees();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                updateMainStats();
                
                // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                updateEmployeeStats();
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
                filterEmployees();
                
                console.log('âœ… All UI components updated');
                
            } catch (error) {
                console.error('âŒ Error updating UI:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function loadTestData() {
            employees = [
                {
                    id: 'emp1',
                    name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    department: 'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
                    regularBalance: 30,
                    regularUsed: 5,
                    emergencyBalance: 7,
                    emergencyUsed: 2,
                    sickUsed: 1,
                    permissionHours: 12
                },
                {
                    id: 'emp2',
                    name: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ Ø­Ø³Ù†',
                    department: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©',
                    regularBalance: 45,
                    regularUsed: 8,
                    emergencyBalance: 7,
                    emergencyUsed: 1,
                    sickUsed: 0,
                    permissionHours: 6
                },
                {
                    id: 'emp3',
                    name: 'Ù…Ø­Ù…Ø¯ Ø³Ø§Ù„Ù… Ø£Ø­Ù…Ø¯',
                    department: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
                    regularBalance: 30,
                    regularUsed: 12,
                    emergencyBalance: 7,
                    emergencyUsed: 3,
                    sickUsed: 2,
                    permissionHours: 18
                },
                {
                    id: 'emp4',
                    name: 'Ù†ÙˆØ±Ø§ Ø£Ø­Ù…Ø¯ ÙŠÙˆØ³Ù',
                    department: 'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©',
                    regularBalance: 30,
                    regularUsed: 3,
                    emergencyBalance: 7,
                    emergencyUsed: 0,
                    sickUsed: 1,
                    permissionHours: 4
                },
                {
                    id: 'emp5',
                    name: 'Ø®Ø§Ù„Ø¯ ÙŠÙˆØ³Ù Ù…Ø­Ù…Ø¯',
                    department: 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚',
                    regularBalance: 45,
                    regularUsed: 15,
                    emergencyBalance: 7,
                    emergencyUsed: 2,
                    sickUsed: 0,
                    permissionHours: 21
                }
            ];
            saturdayShifts = [];
            currentAttendance = [];
            leaveRecords = [];
            resetHistory = [];
            
            console.log('Test data loaded successfully');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function loadEmployeeOptions() {
            const recordSelect = document.getElementById('recordEmployee');
            const saturdaySelect = document.getElementById('saturdayEmployee');
            const attendanceSelect = document.getElementById('attendanceEmployee');
            
            if (recordSelect) {
                recordSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>';
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = `${employee.name} - ${employee.department}`;
                    recordSelect.appendChild(option);
                });
            }
            
            if (saturdaySelect) {
                saturdaySelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>';
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = `${employee.name} - ${employee.department}`;
                    saturdaySelect.appendChild(option);
                });
            }
            
            if (attendanceSelect) {
                attendanceSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>';
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = `${employee.name} - ${employee.department}`;
                    attendanceSelect.appendChild(option);
                });
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function updateMainStats() {
            // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            const totalEmployeesElement = document.getElementById('totalEmployees');
            if (totalEmployeesElement) {
                totalEmployeesElement.textContent = employees.length;
            }
            
            // Ø£Ø±ØµØ¯Ø© Ù…Ù†ØªÙ‡ÙŠØ© (Ø£Ù‚Ù„ Ù…Ù† 5 Ø£ÙŠØ§Ù…)
            const expiredCount = employees.filter(emp => {
                const remaining = (emp.regularBalance || 30) - (emp.regularUsed || 0);
                return remaining < 5;
            }).length;
            const expiredBalancesElement = document.getElementById('expiredBalances');
            if (expiredBalancesElement) {
                expiredBalancesElement.textContent = expiredCount;
            }
            
            // ÙÙŠ Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ…
            const today = new Date().toISOString().split('T')[0];
            const todayLeavesCount = leaveRecords.filter(record => {
                const startDate = record.startDate;
                const endDate = record.endDate || record.startDate;
                return today >= startDate && today <= endDate && record.type !== 'permission';
            }).length;
            const todayLeavesElement = document.getElementById('todayLeaves');
            if (todayLeavesElement) {
                todayLeavesElement.textContent = todayLeavesCount;
            }
            
            // Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ø³Ø¨Øª Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
            const weekStart = getWeekStart(new Date());
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const weekSaturdaysCount = saturdayShifts.filter(shift => {
                const shiftDate = new Date(shift.date);
                return shiftDate >= weekStart && shiftDate <= weekEnd;
            }).length;
            const weekSaturdaysElement = document.getElementById('weekSaturdays');
            if (weekSaturdaysElement) {
                weekSaturdaysElement.textContent = weekSaturdaysCount;
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ø§Ù„Ø³Ø¨Øª)
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1) - 1; // Ø§Ù„Ø³Ø¨Øª = Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
            return new Date(d.setDate(diff));
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        
        // ==================== ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø© ====================
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function updateResetInfo() {
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1; // 0-based
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let fiscalYear;
            if (currentMonth >= 7) {
                fiscalYear = currentYear + '-' + (currentYear + 1);
            } else {
                fiscalYear = (currentYear - 1) + '-' + currentYear;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            const fiscalYearElement = document.getElementById('currentFiscalYear');
            if (fiscalYearElement) {
                fiscalYearElement.textContent = fiscalYear;
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø­ØªÙ‰ 1 ÙŠÙˆÙ„ÙŠÙˆ Ø§Ù„Ù‚Ø§Ø¯Ù…
            const nextJuly = new Date();
            if (currentMonth >= 7) {
                nextJuly.setFullYear(currentYear + 1, 6, 1); // ÙŠÙˆÙ„ÙŠÙˆ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            } else {
                nextJuly.setFullYear(currentYear, 6, 1); // ÙŠÙˆÙ„ÙŠÙˆ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©
            }
            
            const today = new Date();
            const daysUntilJuly = Math.ceil((nextJuly - today) / (1000 * 60 * 60 * 24));
            
            const daysElement = document.getElementById('daysUntilJuly');
            if (daysElement) {
                if (daysUntilJuly > 0) {
                    daysElement.textContent = daysUntilJuly + ' ÙŠÙˆÙ…';
                } else if (daysUntilJuly === 0) {
                    daysElement.textContent = 'Ø§Ù„ÙŠÙˆÙ…!';
                } else {
                    daysElement.textContent = 'Ù…ØªØ£Ø®Ø± ' + Math.abs(daysUntilJuly) + ' ÙŠÙˆÙ…';
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
            updateResetStatus(daysUntilJuly);
            
            // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            updateLastResetDate();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function updateResetStatus(daysUntilJuly) {
            const statusElement = document.getElementById('resetStatus');
            if (!statusElement) return;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¢Ø®Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            let targetYear = currentMonth >= 7 ? currentYear : currentYear - 1;
            
            const hasResetThisYear = resetHistory.some(reset => reset.year === targetYear);
            
            if (hasResetThisYear) {
                statusElement.innerHTML = '<span style="color: var(--neon-green);">âœ… ØªÙ… Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©</span>';
            } else if (daysUntilJuly > 30) {
                statusElement.innerHTML = '<span style="color: var(--neon-blue);">ğŸ“… Ù‚Ø±ÙŠØ¨Ø§Ù‹</span>';
            } else if (daysUntilJuly > 0) {
                statusElement.innerHTML = '<span style="color: var(--neon-yellow);">âš ï¸ Ù…Ø·Ù„ÙˆØ¨ Ù‚Ø±ÙŠØ¨Ø§Ù‹</span>';
            } else {
                statusElement.innerHTML = '<span style="color: var(--neon-red);">ğŸš¨ Ù…ØªØ£Ø®Ø±</span>';
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
        function updateLastResetDate() {
            const lastResetElement = document.getElementById('lastResetDate');
            if (!lastResetElement) return;
            
            if (resetHistory.length === 0) {
                lastResetElement.textContent = 'Ù„Ù… ÙŠØªÙ… Ø¨Ø¹Ø¯';
                return;
            }
            
            // Ø£Ø­Ø¯Ø« Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            const latestReset = resetHistory.sort((a, b) => new Date(b.resetDate) - new Date(a.resetDate))[0];
            const resetDate = new Date(latestReset.resetDate);
            const formattedDate = resetDate.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            lastResetElement.textContent = formattedDate;
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        async function loadResetHistory() {
            try {
                const historySnapshot = await db.collection('reset_history').orderBy('resetDate', 'desc').get();
                resetHistory = historySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('Loaded reset history:', resetHistory);
                updateResetInfo();
            } catch (error) {
                console.error('Error loading reset history:', error);
                resetHistory = [];
                updateResetInfo();
            }
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function openResetBalancesModal() {
            const modal = document.getElementById('resetBalancesModal');
            if (!modal) return;
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø©
            const employeeCountElement = document.getElementById('resetEmployeeCount');
            if (employeeCountElement) {
                employeeCountElement.textContent = employees.length + ' Ù…ÙˆØ¸Ù';
            }
            
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            let newFiscalYear;
            if (currentMonth >= 7) {
                newFiscalYear = (currentYear + 1) + '-' + (currentYear + 2);
            } else {
                newFiscalYear = currentYear + '-' + (currentYear + 1);
            }
            
            const newYearElement = document.getElementById('resetNewYear');
            if (newYearElement) {
                newYearElement.textContent = newFiscalYear;
            }
            
            const resetDateElement = document.getElementById('resetDate');
            if (resetDateElement) {
                const today = new Date();
                const formattedDate = today.toLocaleDateString('ar-SA', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                resetDateElement.textContent = formattedDate;
            }
            
            const resetByElement = document.getElementById('resetBy');
            if (resetByElement && currentUser) {
                resetByElement.textContent = currentUser.email;
            }
            
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function closeResetBalancesModal() {
            const modal = document.getElementById('resetBalancesModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
        }
        
        // ØªÙ†ÙÙŠØ° Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø©
        async function executeResetBalances() {
            if (employees.length === 0) {
                showNotification('resetNotification', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø±ØµØ¯ØªÙ‡Ù…', 'error');
                return;
            }
            
            const confirmBtn = document.getElementById('confirmResetBtn');
            if (!confirmBtn) return;
            
            const originalText = confirmBtn.innerHTML;
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°...';
            
            try {
                const currentYear = new Date().getFullYear();
                const currentMonth = new Date().getMonth() + 1;
                let fiscalYear = currentMonth >= 7 ? currentYear : currentYear - 1;
                
                const resetDate = new Date().toISOString().split('T')[0];
                const affectedEmployees = [];
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ù…ÙˆØ¸Ù
                for (const employee of employees) {
                    const oldData = {
                        regularUsed: employee.regularUsed || 0,
                        emergencyUsed: employee.emergencyUsed || 0,
                        sickUsed: employee.sickUsed || 0,
                        permissionHours: employee.permissionHours || 0
                    };
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                    const updatedEmployee = {
                        ...employee,
                        previousYearData: {
                            year: fiscalYear,
                            regularBalance: employee.regularBalance || 30,
                            regularUsed: employee.regularUsed || 0,
                            emergencyUsed: employee.emergencyUsed || 0,
                            sickUsed: employee.sickUsed || 0,
                            permissionHours: employee.permissionHours || 0
                        },
                        regularUsed: 0,
                        emergencyUsed: 0,
                        sickUsed: 0,
                        permissionHours: 0,
                        lastResetYear: fiscalYear + 1,
                        lastResetDate: resetDate,
                        updatedAt: new Date()
                    };
                    
                    // ØªØ­Ø¯ÙŠØ« ÙÙŠ Firebase
                    await db.collection('employees').doc(employee.id).update(updatedEmployee);
                    
                    // ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    const employeeIndex = employees.findIndex(emp => emp.id === employee.id);
                    if (employeeIndex !== -1) {
                        employees[employeeIndex] = updatedEmployee;
                    }
                    
                    affectedEmployees.push({
                        id: employee.id,
                        name: employee.name,
                        oldUsed: oldData.regularUsed,
                        newUsed: 0
                    });
                }
                
                // Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                const resetRecord = {
                    year: fiscalYear + 1,
                    resetDate: resetDate,
                    resetBy: currentUser.email,
                    employeesCount: employees.length,
                    employeesAffected: affectedEmployees,
                    isAutomatic: false,
                    createdAt: new Date()
                };
                
                const docRef = await db.collection('reset_history').add(resetRecord);
                resetHistory.unshift({
                    id: docRef.id,
                    ...resetRecord
                });
                
                showNotification('resetNotification', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø±ØµØ¯Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶
                updateResetInfo();
                updateBalancesView();
                updateEmployeesTable();
                updateEmployeeStats();
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    closeResetBalancesModal();
                }, 2000);
                
            } catch (error) {
                console.error('Error resetting balances:', error);
                showNotification('resetNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø©: ' + error.message, 'error');
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = originalText;
            }
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function openResetHistoryModal() {
            const modal = document.getElementById('resetHistoryModal');
            const content = document.getElementById('resetHistoryContent');
            
            if (!modal || !content) return;
            
            if (resetHistory.length === 0) {
                content.innerHTML = 
                    '<div style="text-align: center; padding: 3rem; color: var(--primary-200);">' +
                        '<i data-lucide="history" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5;"></i>' +
                        '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø©</p>' +
                    '</div>';
            } else {
                let historyHtml = '';
                
                resetHistory.forEach(reset => {
                    const resetDate = new Date(reset.resetDate);
                    const formattedDate = resetDate.toLocaleDateString('ar-SA', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    historyHtml += 
                        '<div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">' +
                            '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">' +
                                '<h4 style="color: var(--neon-blue); margin: 0;">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ' + reset.year + '</h4>' +
                                '<span style="color: var(--neon-green); font-size: 0.9rem;">' + formattedDate + '</span>' +
                            '</div>' +
                            '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.75rem;">' +
                                '<div>' +
                                    '<span style="color: var(--primary-200);">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:</span> ' +
                                    '<span style="color: var(--neon-blue); font-weight: bold;">' + reset.employeesCount + '</span>' +
                                '</div>' +
                                '<div>' +
                                    '<span style="color: var(--primary-200);">Ø§Ù„Ù…Ù†ÙØ°:</span> ' +
                                    '<span style="color: var(--neon-yellow); font-weight: bold;">' + reset.resetBy + '</span>' +
                                '</div>' +
                            '</div>' +
                            '<div style="color: var(--primary-200); font-size: 0.9rem;">ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø±ØµØ¯Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­</div>' +
                        '</div>';
                });
                
                content.innerHTML = historyHtml;
            }
            
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø³Ø¬Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function closeResetHistoryModal() {
            const modal = document.getElementById('resetHistoryModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        function checkResetAlerts() {
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø­ØªÙ‰ 1 ÙŠÙˆÙ„ÙŠÙˆ
            const nextJuly = new Date();
            if (currentMonth >= 7) {
                nextJuly.setFullYear(currentYear + 1, 6, 1);
            } else {
                nextJuly.setFullYear(currentYear, 6, 1);
            }
            
            const today = new Date();
            const daysUntilJuly = Math.ceil((nextJuly - today) / (1000 * 60 * 60 * 24));
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
            let targetYear = currentMonth >= 7 ? currentYear : currentYear - 1;
            const hasResetThisYear = resetHistory.some(reset => reset.year === targetYear);
            
            // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            if (!hasResetThisYear && (daysUntilJuly <= 30 || daysUntilJuly < 0)) {
                showResetAlert(daysUntilJuly);
            }
        }
        
        // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        function showResetAlert(daysUntilJuly) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ù† ÙˆØ¬Ø¯
            const existingAlert = document.getElementById('resetAlert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            let alertMessage;
            let alertColor;
            
            if (daysUntilJuly > 0) {
                alertMessage = 'Ø¨Ø§Ù‚ÙŠ ' + daysUntilJuly + ' ÙŠÙˆÙ… Ø¹Ù„Ù‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - ÙŠÙÙ†ØµØ­ Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹';
                alertColor = 'var(--neon-yellow)';
            } else if (daysUntilJuly === 0) {
                alertMessage = 'Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© - ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª';
                alertColor = 'var(--neon-orange)';
            } else {
                alertMessage = 'ØªØ£Ø®Ø±Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø¨Ù€ ' + Math.abs(daysUntilJuly) + ' ÙŠÙˆÙ… - ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† ÙÙˆØ±Ø§Ù‹';
                alertColor = 'var(--neon-red)';
            }
            
            const alertDiv = document.createElement('div');
            alertDiv.id = 'resetAlert';
            alertDiv.style.cssText = 
                'background: rgba(255, 235, 59, 0.1); border: 1px solid ' + alertColor + '; ' +
                'border-radius: 8px; padding: 1rem; margin-bottom: 1rem; ' +
                'display: flex; justify-content: space-between; align-items: center;';
            
            alertDiv.innerHTML = 
                '<div style="display: flex; align-items: center; gap: 0.5rem;">' +
                    '<i data-lucide="alert-triangle" style="color: ' + alertColor + '; width: 20px; height: 20px;"></i>' +
                    '<span style="color: ' + alertColor + ';">' + alertMessage + '</span>' +
                '</div>' +
                '<div style="display: flex; gap: 0.5rem;">' +
                    '<button onclick="switchTab(\'employees\')" class="btn-neon" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¢Ù†</button>' +
                    '<button onclick="document.getElementById(\'resetAlert\').remove()" style="background: none; border: none; color: ' + alertColor + '; cursor: pointer; padding: 0.5rem;">' +
                        '<i data-lucide="x" style="width: 16px; height: 16px;"></i>' +
                    '</button>' +
                '</div>';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            const mainScreen = document.querySelector('.main-screen');
            if (mainScreen) {
                const welcomeMessage = mainScreen.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.insertAdjacentElement('afterend', alertDiv);
                    lucide.createIcons();
                }
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† Firebase
        async function loadDepartments() {
            try {
                console.log('Loading departments from Firebase...');
                const departmentsSnapshot = await db.collection('departments').get();
                if (!departmentsSnapshot.empty) {
                    departments = departmentsSnapshot.docs.map(doc => doc.data().name);
                    console.log('Loaded departments from Firebase:', departments);
                } else {
                    console.log('No departments found, creating default ones...');
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Firebase
                    const defaultDepartments = ['ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©', 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'];
                    for (const dept of defaultDepartments) {
                        await db.collection('departments').add({ name: dept, createdAt: new Date() });
                    }
                    departments = defaultDepartments;
                    console.log('Created default departments:', departments);
                }
                updateDepartmentSelects();
            } catch (error) {
                console.error('Error loading departments:', error);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                departments = ['ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©', 'Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'];
                console.log('Using fallback departments:', departments);
                updateDepartmentSelects();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        function updateDepartmentSelects() {
            console.log('Updating department selects with departments:', departments);
            const selects = ['employeeDepartment', 'departmentFilter'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    const isFilter = selectId === 'departmentFilter';
                    
                    select.innerHTML = isFilter ? '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>' : '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… --</option>';
                    
                    departments.forEach(dept => {
                        const option = document.createElement('option');
                        option.value = dept;
                        option.textContent = dept;
                        select.appendChild(option);
                    });
                    
                    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹
                    if (currentValue && departments.includes(currentValue)) {
                        select.value = currentValue;
                    }
                    
                    console.log(`Updated ${selectId} with ${departments.length} departments`);
                } else {
                    console.warn(`Select element ${selectId} not found`);
                }
            });
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function openDepartmentsModal() {
            console.log('Opening departments modal...');
            const modal = document.getElementById('departmentsModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                updateDepartmentsList();
                // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                if (departments.length === 0) {
                    loadDepartments().then(() => {
                        updateDepartmentsList();
                    });
                }
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
                setTimeout(() => {
                    lucide.createIcons();
                }, 100);
            } else {
                console.error('Departments modal not found');
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function closeDepartmentsModal() {
            const modal = document.getElementById('departmentsModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
            const nameInput = document.getElementById('newDepartmentName');
            if (nameInput) {
                nameInput.value = '';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function updateDepartmentsList() {
            const container = document.getElementById('departmentsList');
            
            if (departments.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--primary-200);">
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…Ø¶Ø§ÙØ©</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            departments.forEach(dept => {
                const employeeCount = employees.filter(emp => emp.department === dept).length;
                
                const deptElement = document.createElement('div');
                deptElement.style.cssText = `
                    background: rgba(0, 35, 102, 0.2);
                    border: 1px solid rgba(0, 212, 255, 0.2);
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 0.75rem;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù†ÙØµÙ„Ø©
                const leftDiv = document.createElement('div');
                const nameDiv = document.createElement('div');
                nameDiv.style.cssText = 'color: var(--neon-blue); font-weight: 500;';
                nameDiv.textContent = dept;
                
                const countDiv = document.createElement('div');
                countDiv.style.cssText = 'color: var(--primary-200); font-size: 0.8rem;';
                countDiv.textContent = employeeCount + ' Ù…ÙˆØ¸Ù';
                
                leftDiv.appendChild(nameDiv);
                leftDiv.appendChild(countDiv);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-department-btn';
                deleteBtn.dataset.department = dept;
                deleteBtn.style.cssText = 'background: rgba(255, 68, 68, 0.2); border: 1px solid rgba(255, 68, 68, 0.5); color: var(--neon-red); padding: 0.5rem; border-radius: 4px; cursor: pointer;';
                
                if (employeeCount > 0) {
                    deleteBtn.disabled = true;
                    deleteBtn.title = 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‚Ø³Ù… ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ÙˆØ¸ÙÙŠÙ†';
                    deleteBtn.style.opacity = '0.5';
                    deleteBtn.style.cursor = 'not-allowed';
                }
                
                const deleteIcon = document.createElement('i');
                deleteIcon.setAttribute('data-lucide', 'trash-2');
                deleteIcon.style.cssText = 'width: 16px; height: 16px;';
                deleteBtn.appendChild(deleteIcon);
                
                deptElement.appendChild(leftDiv);
                deptElement.appendChild(deleteBtn);
                container.appendChild(deptElement);
            });
            
            lucide.createIcons();
        }

        // Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯
        async function addDepartment() {
            const deptName = document.getElementById('newDepartmentName').value.trim();
            
            if (!deptName) {
                showNotification('departmentsNotification', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…', 'error');
                return;
            }
            
            if (departments.includes(deptName)) {
                showNotification('departmentsNotification', 'Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }
            
            try {
                console.log('Adding new department:', deptName);
                // Ø­ÙØ¸ ÙÙŠ Firebase
                await db.collection('departments').add({
                    name: deptName,
                    createdAt: new Date(),
                    createdBy: currentUser.email
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                departments.push(deptName);
                console.log('Department added. Current departments:', departments);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶
                updateDepartmentSelects();
                updateDepartmentsList();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚Ù„
                document.getElementById('newDepartmentName').value = '';
                
                showNotification('departmentsNotification', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Error adding department:', error);
                showNotification('departmentsNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù…: ' + error.message, 'error');
            }
        }

        // Ø­Ø°Ù Ù‚Ø³Ù…
        async function deleteDepartment(deptName) {
            console.log('Attempting to delete department:', deptName);
            
            const employeeCount = employees.filter(emp => emp.department === deptName).length;
            console.log('Employee count in department:', employeeCount);
            
            if (employeeCount > 0) {
                showNotification('departmentsNotification', 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ù‚Ø³Ù… ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ÙˆØ¸ÙÙŠÙ†', 'error');
                return;
            }
            
            const confirmDelete = confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù… "${deptName}"ØŸ`);
            if (!confirmDelete) return;
            
            try {
                console.log('Deleting department from Firebase...');
                // Ø­Ø°Ù Ù…Ù† Firebase
                const departmentsSnapshot = await db.collection('departments').where('name', '==', deptName).get();
                console.log('Found documents to delete:', departmentsSnapshot.size);
                
                const deletePromises = [];
                departmentsSnapshot.forEach((doc) => {
                    deletePromises.push(doc.ref.delete());
                });
                
                await Promise.all(deletePromises);
                console.log('Department deleted from Firebase');
                
                // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const deptIndex = departments.indexOf(deptName);
                if (deptIndex !== -1) {
                    departments.splice(deptIndex, 1);
                    console.log('Department removed from local array. Remaining departments:', departments);
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶
                updateDepartmentSelects();
                updateDepartmentsList();
                
                showNotification('departmentsNotification', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Error deleting department:', error);
                showNotification('departmentsNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù…: ' + error.message, 'error');
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        
        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
        function handlePhotoPreview(input) {
            const file = input.files[0];
            const preview = document.getElementById('photoPreview');
            const previewImg = document.getElementById('previewImg');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                preview.classList.add('hidden');
            }
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Base64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ±ØªÙŠØ¨
        function toggleSortDirection() {
            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            const sortIcon = document.getElementById('sortIcon');
            sortIcon.setAttribute('data-lucide', sortDirection === 'asc' ? 'arrow-up' : 'arrow-down');
            refreshIcons();
            currentPage = 1;
            filterEmployees();
        }

        // ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø©
        function changePage(direction) {
            const employeesToShow = filteredEmployees.length > 0 ? filteredEmployees : employees;
            const totalPages = Math.ceil(employeesToShow.length / employeesPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updateEmployeesTable();
            }
        }

        // ØªØ­Ø¯ÙŠØ« ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª
        function updatePagination() {
            const employeesToShow = filteredEmployees.length > 0 ? filteredEmployees : employees;
            const totalPages = Math.ceil(employeesToShow.length / employeesPerPage);
            const pagination = document.getElementById('pagination');
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ… ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©
            if (totalPages <= 1) {
                pagination.classList.add('hidden');
                return;
            }
            
            pagination.classList.remove('hidden');
            pageInfo.textContent = `ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages} (${employeesToShow.length} Ù…ÙˆØ¸Ù)`;
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            prevBtn.style.opacity = currentPage === 1 ? '0.5' : '1';
            nextBtn.style.opacity = currentPage === totalPages ? '0.5' : '1';
        }

        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function sortEmployees(employeesList) {
            return employeesList.sort((a, b) => {
                let aValue, bValue;
                
                switch (sortColumn) {
                    case 'name':
                        aValue = a.name.toLowerCase();
                        bValue = b.name.toLowerCase();
                        break;
                    case 'department':
                        aValue = a.department.toLowerCase();
                        bValue = b.department.toLowerCase();
                        break;
                    case 'regularBalance':
                        aValue = (a.regularBalance || 30) - (a.regularUsed || 0);
                        bValue = (b.regularBalance || 30) - (b.regularUsed || 0);
                        break;
                    case 'createdAt':
                        aValue = new Date(a.createdAt || 0);
                        bValue = new Date(b.createdAt || 0);
                        break;
                    default:
                        aValue = a.name.toLowerCase();
                        bValue = b.name.toLowerCase();
                }
                
                if (sortDirection === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function updateEmployeeStats() {
            const totalCount = employees.length;
            const lowBalanceCount = employees.filter(emp => {
                const remaining = (emp.regularBalance || 30) - (emp.regularUsed || 0);
                return remaining < 5;
            }).length;
            
            const departments = [...new Set(employees.map(emp => emp.department))];
            const activeDepartments = departments.length;
            
            const avgBalance = employees.length > 0 ? 
                employees.reduce((sum, emp) => sum + ((emp.regularBalance || 30) - (emp.regularUsed || 0)), 0) / employees.length : 0;
            
            const totalEmployeesCountElement = document.getElementById('totalEmployeesCount');
            if (totalEmployeesCountElement) {
                totalEmployeesCountElement.textContent = totalCount;
            }
            
            const lowBalanceCountElement = document.getElementById('lowBalanceCount');
            if (lowBalanceCountElement) {
                lowBalanceCountElement.textContent = lowBalanceCount;
            }
            
            const activeDepartmentsElement = document.getElementById('activeDepartments');
            if (activeDepartmentsElement) {
                activeDepartmentsElement.textContent = activeDepartments;
            }
            
            const avgBalanceElement = document.getElementById('avgBalance');
            if (avgBalanceElement) {
                avgBalanceElement.textContent = avgBalance.toFixed(1);
            }
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function filterEmployees() {
            const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
            const departmentFilter = document.getElementById('departmentFilter').value;
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            let filtered = employees.filter(employee => {
                const matchesSearch = employee.name.toLowerCase().includes(searchTerm) ||
                                    employee.department.toLowerCase().includes(searchTerm);
                const matchesDepartment = !departmentFilter || employee.department === departmentFilter;
                
                return matchesSearch && matchesDepartment;
            });
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            filteredEmployees = sortEmployees(filtered);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            updateEmployeesTable();
            updatePagination();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function updateEmployeesTable() {
            const tbody = document.getElementById('employeesTableBody');
            const employeesToShow = filteredEmployees.length > 0 ? filteredEmployees : employees;
            
            if (employeesToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 3rem; color: var(--primary-200);">
                            <i data-lucide="users" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</p>
                        </td>
                    </tr>
                `;
                lucide.createIcons();
                document.getElementById('pagination').classList.add('hidden');
                return;
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const startIndex = (currentPage - 1) * employeesPerPage;
            const endIndex = startIndex + employeesPerPage;
            const pageEmployees = employeesToShow.slice(startIndex, endIndex);
            
            tbody.innerHTML = '';
            
            pageEmployees.forEach(employee => {
                const regularRemaining = (employee.regularBalance || 30) - (employee.regularUsed || 0);
                const emergencyRemaining = (employee.emergencyBalance || 7) - (employee.emergencyUsed || 0);
                
                const statusColor = regularRemaining > 10 ? 'var(--neon-green)' : 
                                  regularRemaining > 5 ? 'var(--neon-yellow)' : 'var(--neon-red)';
                const statusText = regularRemaining > 10 ? 'Ø¬ÙŠØ¯' : 
                                 regularRemaining > 5 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶';
                
                const row = document.createElement('tr');
                row.style.cssText = `
                    border-bottom: 1px solid rgba(0, 212, 255, 0.1);
                    transition: background-color 0.3s ease;
                `;
                
                row.addEventListener('mouseenter', () => {
                    row.style.backgroundColor = 'rgba(0, 212, 255, 0.05)';
                });
                
                row.addEventListener('mouseleave', () => {
                    row.style.backgroundColor = 'transparent';
                });
                
                // ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù
                let photoHtml;
                if (employee.photo) {
                    photoHtml = `<img src="${employee.photo}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--neon-blue);">`;
                } else {
                    photoHtml = `<div style="width: 40px; height: 40px; border-radius: 50%; background: rgba(0, 212, 255, 0.2); display: flex; align-items: center; justify-content: center; border: 2px solid var(--neon-blue);">
                        <i data-lucide="user" style="width: 20px; height: 20px; color: var(--neon-blue);"></i>
                    </div>`;
                }
                
                // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
                let notesHtml = '';
                if (employee.notes) {
                    const shortNotes = employee.notes.length > 50 ? employee.notes.substring(0, 50) + '...' : employee.notes;
                    notesHtml = `<div style="font-size: 0.8rem; color: var(--primary-200); margin-top: 0.25rem;">${shortNotes}</div>`;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… createElement Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ template strings
                const nameCell = document.createElement('td');
                nameCell.style.cssText = 'padding: 0.75rem; color: var(--neon-blue); font-weight: 500;';
                const nameDiv = document.createElement('div');
                nameDiv.textContent = employee.name;
                nameCell.appendChild(nameDiv);
                
                if (employee.notes) {
                    const notesDiv = document.createElement('div');
                    notesDiv.style.cssText = 'font-size: 0.8rem; color: var(--primary-200); margin-top: 0.25rem;';
                    const shortNotes = employee.notes.length > 50 ? employee.notes.substring(0, 50) + '...' : employee.notes;
                    notesDiv.textContent = shortNotes;
                    nameCell.appendChild(notesDiv);
                }
                
                // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
                const photoCell = document.createElement('td');
                photoCell.style.cssText = 'padding: 0.75rem; text-align: center;';
                photoCell.innerHTML = photoHtml;
                
                const deptCell = document.createElement('td');
                deptCell.style.cssText = 'padding: 0.75rem; text-align: center; color: var(--primary-200);';
                deptCell.textContent = employee.department;
                
                const regularCell = document.createElement('td');
                regularCell.style.cssText = 'padding: 0.75rem; text-align: center; color: var(--neon-green);';
                regularCell.textContent = regularRemaining + '/' + (employee.regularBalance || 30);
                
                const emergencyCell = document.createElement('td');
                emergencyCell.style.cssText = 'padding: 0.75rem; text-align: center; color: var(--neon-yellow);';
                emergencyCell.textContent = emergencyRemaining + '/' + (employee.emergencyBalance || 7);
                
                const permissionCell = document.createElement('td');
                permissionCell.style.cssText = 'padding: 0.75rem; text-align: center; color: var(--neon-orange);';
                permissionCell.textContent = (employee.permissionHours || 0) + 'Ø³';
                
                const statusCell = document.createElement('td');
                statusCell.style.cssText = `padding: 0.75rem; text-align: center; color: ${statusColor}; font-weight: 500;`;
                statusCell.textContent = statusText;
                
                const actionsCell = document.createElement('td');
                actionsCell.style.cssText = 'padding: 0.75rem; text-align: center;';
                
                const actionsDiv = document.createElement('div');
                actionsDiv.style.cssText = 'display: flex; gap: 0.5rem; justify-content: center;';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-employee-btn';
                editBtn.dataset.employeeId = employee.id;
                editBtn.style.cssText = 'background: rgba(0, 212, 255, 0.2); border: 1px solid rgba(0, 212, 255, 0.5); color: var(--neon-blue); padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;';
                editBtn.innerHTML = '<i data-lucide="edit-2" style="width: 14px; height: 14px;"></i> ØªØ¹Ø¯ÙŠÙ„';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-employee-btn';
                deleteBtn.dataset.employeeId = employee.id;
                deleteBtn.style.cssText = 'background: rgba(255, 68, 68, 0.2); border: 1px solid rgba(255, 68, 68, 0.5); color: var(--neon-red); padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;';
                deleteBtn.innerHTML = '<i data-lucide="trash-2" style="width: 14px; height: 14px;"></i> Ø­Ø°Ù';
                
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
                actionsCell.appendChild(actionsDiv);
                
                // Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ù„Ù„ØµÙ
                row.appendChild(photoCell);
                row.appendChild(nameCell);
                row.appendChild(deptCell);
                row.appendChild(regularCell);
                row.appendChild(emergencyCell);
                row.appendChild(permissionCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                tbody.appendChild(row);
            });
            
            lucide.createIcons();
            updatePagination();
        }

        // Ø­ÙØ¸/ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¸Ù
        async function handleEmployeeSubmit() {
            console.log('Starting employee submit...');
            
            const nameInput = document.getElementById('employeeName');
            const departmentInput = document.getElementById('employeeDepartment');
            const regularBalanceInput = document.getElementById('regularBalance');
            const emergencyBalanceInput = document.getElementById('emergencyBalance');
            const regularUsedInput = document.getElementById('regularUsed');
            const emergencyUsedInput = document.getElementById('emergencyUsed');
            const permissionHoursInput = document.getElementById('permissionHours');
            const sickUsedInput = document.getElementById('sickUsed');
            const notesInput = document.getElementById('employeeNotes');
            const photoInput = document.getElementById('employeePhoto');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            if (!nameInput || !departmentInput || !regularBalanceInput || !emergencyBalanceInput) {
                console.error('Required form elements not found');
                showNotification('employeesNotification', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ - ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'error');
                return;
            }
            
            const name = nameInput.value.trim();
            const department = departmentInput.value;
            const regularBalance = parseInt(regularBalanceInput.value);
            const emergencyBalance = parseInt(emergencyBalanceInput.value);
            const regularUsed = parseInt(regularUsedInput ? regularUsedInput.value : 0) || 0;
            const emergencyUsed = parseInt(emergencyUsedInput ? emergencyUsedInput.value : 0) || 0;
            const permissionHours = parseInt(permissionHoursInput ? permissionHoursInput.value : 0) || 0;
            const sickUsed = parseInt(sickUsedInput ? sickUsedInput.value : 0) || 0;
            const notes = notesInput ? notesInput.value.trim() : '';
            const photoFile = photoInput ? photoInput.files[0] : null;
            
            console.log('Form data:', { name, department, regularBalance, emergencyBalance });
            
            if (!name || !department) {
                showNotification('employeesNotification', 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            if (regularUsed > regularBalance || emergencyUsed > emergencyBalance) {
                showNotification('employeesNotification', 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ', 'error');
                return;
            }
            
            // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
            const saveBtn = document.getElementById('saveEmployeeBtn');
            const saveBtnText = document.getElementById('saveEmployeeBtnText');
            if (!saveBtn || !saveBtnText) {
                console.error('Save button elements not found');
                showNotification('employeesNotification', 'Ø®Ø·Ø£ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                return;
            }
            
            const originalText = saveBtn.innerHTML;
            saveBtn.disabled = true;
            saveBtnText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
            
            const employeeData = {
                name: name,
                department: department,
                regularBalance: regularBalance,
                emergencyBalance: emergencyBalance,
                regularUsed: regularUsed,
                emergencyUsed: emergencyUsed,
                permissionHours: permissionHours,
                sickUsed: sickUsed,
                notes: notes || null,
                createdBy: currentUser.email,
                updatedAt: new Date()
            };
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
            if (photoFile) {
                try {
                    console.log('Processing image...');
                    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© (Ø£Ù‚Ù„ Ù…Ù† 1MB)
                    if (photoFile.size > 1024 * 1024) {
                        showNotification('employeesNotification', 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 1MB)', 'error');
                        saveBtn.disabled = false;
                        saveBtn.innerHTML = originalText;
                        return;
                    }
                    
                    const photoBase64 = await convertImageToBase64(photoFile);
                    employeeData.photo = photoBase64;
                    console.log('Image processed successfully');
                } catch (error) {
                    console.error('Error converting image:', error);
                    showNotification('employeesNotification', 'Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©', 'error');
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = originalText;
                    return;
                }
            }
            
            try {
                console.log('Saving to Firebase...');
                
                if (editingEmployeeId) {
                    // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¸Ù Ù…ÙˆØ¬ÙˆØ¯
                    if (!photoFile) {
                        const existingEmployee = employees.find(emp => emp.id === editingEmployeeId);
                        if (existingEmployee && existingEmployee.photo) {
                            employeeData.photo = existingEmployee.photo;
                        }
                    }
                    
                    await db.collection('employees').doc(editingEmployeeId).update(employeeData);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    const employeeIndex = employees.findIndex(emp => emp.id === editingEmployeeId);
                    if (employeeIndex !== -1) {
                        employees[employeeIndex] = { id: editingEmployeeId, ...employeeData };
                    }
                    
                    showNotification('employeesNotification', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
                    employeeData.createdAt = new Date();
                    console.log('Adding new employee:', employeeData);
                    
                    const docRef = await db.collection('employees').add(employeeData);
                    console.log('Employee added with ID:', docRef.id);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    employees.push({
                        id: docRef.id,
                        ...employeeData
                    });
                    
                    showNotification('employeesNotification', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                resetEmployeeForm();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶
                currentPage = 1;
                filterEmployees();
                updateEmployeeStats();
                updateBalancesView();
                loadEmployeeOptions();
                
                console.log('Employee saved successfully');
                
            } catch (error) {
                console.error('Error saving employee:', error);
                showNotification('employeesNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù: ' + error.message, 'error');
            } finally {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­ÙØ¸
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
            }
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¸Ù
        function editEmployee(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            editingEmployeeId = employeeId;
            
            // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
            document.getElementById('employeeName').value = employee.name;
            document.getElementById('employeeDepartment').value = employee.department;
            document.getElementById('regularBalance').value = employee.regularBalance || 30;
            document.getElementById('emergencyBalance').value = employee.emergencyBalance || 7;
            document.getElementById('regularUsed').value = employee.regularUsed || 0;
            document.getElementById('emergencyUsed').value = employee.emergencyUsed || 0;
            document.getElementById('permissionHours').value = employee.permissionHours || 0;
            document.getElementById('sickUsed').value = employee.sickUsed || 0;
            document.getElementById('employeeNotes').value = employee.notes || '';
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const photoPreview = document.getElementById('photoPreview');
            const previewImg = document.getElementById('previewImg');
            if (employee.photo) {
                previewImg.src = employee.photo;
                photoPreview.classList.remove('hidden');
            } else {
                photoPreview.classList.add('hidden');
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('employeeFormTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù';
            document.getElementById('saveEmployeeBtnText').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
            document.getElementById('cancelEmployeeBtn').classList.remove('hidden');
        }

        // Ø­Ø°Ù Ù…ÙˆØ¸Ù
        async function deleteEmployee(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            const confirmDelete = confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù "${employee.name}"ØŸ\n\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.`);
            if (!confirmDelete) return;
            
            try {
                // Ø­Ø°Ù Ù…Ù† Firebase
                await db.collection('employees').doc(employeeId).delete();
                
                // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                const employeeIndex = employees.findIndex(emp => emp.id === employeeId);
                if (employeeIndex !== -1) {
                    employees.splice(employeeIndex, 1);
                }
                
                showNotification('employeesNotification', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù "${employee.name}" Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶
                updateEmployeesTable();
                updateEmployeeStats();
                updateBalancesView();
                loadEmployeeOptions();
                
            } catch (error) {
                console.error('Error deleting employee:', error);
                showNotification('employeesNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
            }
        }

        // Ø¥Ù„ØºØ§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù
        function cancelEmployeeEdit() {
            resetEmployeeForm();
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ¸Ù
        function resetEmployeeForm() {
            editingEmployeeId = null;
            document.getElementById('employeeForm').reset();
            document.getElementById('regularBalance').value = 30;
            document.getElementById('emergencyBalance').value = 7;
            document.getElementById('employeeFormTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯';
            document.getElementById('saveEmployeeBtnText').textContent = 'Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù';
            document.getElementById('cancelEmployeeBtn').classList.add('hidden');
            document.getElementById('photoPreview').classList.add('hidden');
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… 12 Ø³Ø§Ø¹Ø© Ù…Ø¹ AM/PM
        function formatTime12Hour(time24) {
            if (!time24) return '';
            
            const [hours, minutes] = time24.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            
            return `${hour12}:${minutes} ${ampm}`;
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ù…Ù† 12 Ø³Ø§Ø¹Ø© Ø¥Ù„Ù‰ 24 Ø³Ø§Ø¹Ø© Ù„Ù„Ø­ÙØ¸
        function formatTime24Hour(time12) {
            if (!time12) return '';
            
            const [time, ampm] = time12.split(' ');
            const [hours, minutes] = time.split(':');
            let hour = parseInt(hours);
            
            if (ampm === 'PM' && hour !== 12) {
                hour += 12;
            } else if (ampm === 'AM' && hour === 12) {
                hour = 0;
            }
            
            return `${hour.toString().padStart(2, '0')}:${minutes}`;
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ù†Ø¸Ø§Ù… 24 Ø³Ø§Ø¹Ø©
        function getCurrentTime24() {
            return new Date().toTimeString().slice(0, 5);
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù
        function updateAttendanceButton() {
            const employeeId = document.getElementById('attendanceEmployee').value;
            const attendanceBtn = document.getElementById('attendanceBtnText');
            const attendanceIcon = document.getElementById('attendanceIcon');
            const departureTimeGroup = document.getElementById('departureTimeGroup');
            const customArrivalTime = document.getElementById('customArrivalTime');
            const customDepartureTime = document.getElementById('customDepartureTime');
            
            if (!employeeId) {
                attendanceBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±';
                attendanceIcon.setAttribute('data-lucide', 'play');
                if (departureTimeGroup) departureTimeGroup.style.display = 'none';
                if (customArrivalTime) customArrivalTime.disabled = false;
                if (customDepartureTime) customDepartureTime.disabled = true;
                lucide.createIcons();
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const existingAttendance = currentAttendance.find(attendance => 
                attendance.employeeId === employeeId && attendance.date === today
            );
            
            if (!existingAttendance || existingAttendance.departureTime) {
                attendanceBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±';
                attendanceIcon.setAttribute('data-lucide', 'play');
                if (departureTimeGroup) departureTimeGroup.style.display = 'none';
                if (customArrivalTime) customArrivalTime.disabled = false;
                if (customDepartureTime) customDepartureTime.disabled = true;
            } else {
                attendanceBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù';
                attendanceIcon.setAttribute('data-lucide', 'square');
                if (departureTimeGroup) departureTimeGroup.style.display = 'block';
                if (customArrivalTime) customArrivalTime.disabled = true;
                if (customDepartureTime) customDepartureTime.disabled = false;
            }
            
            lucide.createIcons();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
        function updateCurrentDate() {
            const today = new Date();
            const formattedDate = today.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
            const currentDateElement = document.getElementById('currentDate');
            if (currentDateElement) {
                currentDateElement.textContent = formattedDate;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…
        function updateTodayAttendees() {
            const today = new Date().toISOString().split('T')[0];
            const todayAttendeesCount = currentAttendance.filter(attendance => 
                attendance.date === today && !attendance.departureTime
            ).length;
            
            const todayAttendeesElement = document.getElementById('todayAttendees');
            if (todayAttendeesElement) {
                todayAttendeesElement.textContent = todayAttendeesCount;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹
        function updateCurrentAttendees() {
            const container = document.getElementById('currentAttendees');
            const today = new Date().toISOString().split('T')[0];
            
            // Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ÙŠÙ†ØµØ±ÙÙˆØ§ Ø¨Ø¹Ø¯
            const todayAttendees = currentAttendance.filter(attendance => 
                attendance.date === today && !attendance.departureTime
            );
            
            if (todayAttendees.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--primary-200);">
                        <i data-lucide="clock" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† Ø­Ø§Ø¶Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            container.innerHTML = '';
            
            todayAttendees.forEach(attendance => {
                const employee = employees.find(emp => emp.id === attendance.employeeId);
                if (!employee) return;
                
                const attendanceElement = document.createElement('div');
                attendanceElement.style.cssText = `
                    background: rgba(0, 35, 102, 0.2);
                    border: 1px solid rgba(0, 212, 255, 0.2);
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 0.75rem;
                    transition: all 0.3s ease;
                `;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                const arrivalParts = attendance.arrivalTime.split(':');
                const arrivalDate = new Date();
                arrivalDate.setHours(parseInt(arrivalParts[0]), parseInt(arrivalParts[1]), 0, 0);
                
                const currentTime = new Date();
                let workingHours = Math.max(0, (currentTime - arrivalDate) / (1000 * 60 * 60));
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£Ù‚Ù„ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ø­Ø¶ÙˆØ± ÙƒØ§Ù† Ø¨Ø§Ù„Ø£Ù…Ø³
                if (workingHours > 24) {
                    workingHours = workingHours % 24;
                }
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ù†ØµÙˆØµ
                const progressColor = workingHours >= 8 ? 'var(--neon-green)' : workingHours >= 6 ? 'var(--neon-yellow)' : 'var(--neon-blue)';
                const progressText = workingHours >= 8 ? 'Ù…ÙƒØªÙ…Ù„ âœ“' : 'Ø¨Ø§Ù‚ÙŠ ' + (8 - workingHours).toFixed(1) + ' Ø³Ø§Ø¹Ø©';
                const progressWidth = Math.min(100, (workingHours / 8) * 100);
                
                let countdownHtml = '';
                if (workingHours < 8) {
                    const remainingHours = Math.floor(8 - workingHours);
                    const remainingMinutes = Math.floor(((8 - workingHours) % 1) * 60);
                    countdownHtml = '<div style="text-align: center; font-size: 0.8rem; color: var(--neon-orange); font-weight: 500;">â° ' + remainingHours + 'Ø³ ' + remainingMinutes + 'Ø¯ Ù…ØªØ¨Ù‚ÙŠØ©</div>';
                } else {
                    countdownHtml = '<div style="text-align: center; font-size: 0.8rem; color: var(--neon-green); font-weight: 500;">ğŸ‰ ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ 8 Ø³Ø§Ø¹Ø§Øª!</div>';
                }
                
                attendanceElement.innerHTML = 
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">' +
                        '<div>' +
                            '<h4 style="color: var(--neon-blue); font-size: 0.9rem; margin-bottom: 0.25rem;">' + employee.name + '</h4>' +
                            '<p style="color: var(--primary-200); font-size: 0.8rem;">Ø­Ø¶Ø± Ø§Ù„Ø³Ø§Ø¹Ø© ' + formatTime12Hour(attendance.arrivalTime) + '</p>' +
                        '</div>' +
                        '<div style="text-align: left;">' +
                            '<span style="color: var(--neon-green); font-weight: bold; font-size: 0.9rem;">' + workingHours.toFixed(1) + ' Ø³Ø§Ø¹Ø©</span>' +
                        '</div>' +
                    '</div>' +
                    '<!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->' +
                    '<div style="margin-bottom: 0.5rem;">' +
                        '<div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">' +
                            '<span style="color: var(--primary-200);">Ø§Ù„ØªÙ‚Ø¯Ù… Ù†Ø­Ùˆ 8 Ø³Ø§Ø¹Ø§Øª</span>' +
                            '<span style="color: ' + progressColor + '; font-weight: bold;">' + progressText + '</span>' +
                        '</div>' +
                        '<div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">' +
                            '<div style="height: 100%; background: ' + progressColor + '; width: ' + progressWidth + '%; transition: width 0.3s ease; border-radius: 4px;"></div>' +
                        '</div>' +
                    '</div>' +
                    '<!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ -->' +
                    countdownHtml;
                
                container.appendChild(attendanceElement);
            });
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù
        async function handleAttendanceSubmit() {
            const employeeId = document.getElementById('attendanceEmployee').value;
            const customArrivalTime = document.getElementById('customArrivalTime').value;
            const customDepartureTime = document.getElementById('customDepartureTime').value;
            
            if (!employeeId) {
                showNotification('saturdayNotification', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
                return;
            }
            
            const employee = employees.find(emp => emp.id === employeeId);
            const today = new Date().toISOString().split('T')[0];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…
            const existingAttendance = currentAttendance.find(attendance => 
                attendance.employeeId === employeeId && attendance.date === today
            );
            
            try {
                if (!existingAttendance) {
                    // ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø¬Ø¯ÙŠØ¯
                    const arrivalTime = customArrivalTime || getCurrentTime24();
                    
                    const attendanceData = {
                        employeeId: employeeId,
                        employeeName: employee.name,
                        date: today,
                        arrivalTime: arrivalTime,
                        departureTime: null,
                        createdBy: currentUser.email,
                        createdAt: new Date()
                    };
                    
                    const docRef = await db.collection('current_attendance').add(attendanceData);
                    
                    currentAttendance.push({
                        id: docRef.id,
                        ...attendanceData
                    });
                    
                    showNotification('saturdayNotification', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ' + employee.name + ' Ø§Ù„Ø³Ø§Ø¹Ø© ' + formatTime12Hour(arrivalTime), 'success');
                    
                } else if (!existingAttendance.departureTime) {
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù
                    const departureTime = customDepartureTime || getCurrentTime24();
                    
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
                    const arrivalParts = existingAttendance.arrivalTime.split(':');
                    const departureParts = departureTime.split(':');
                    
                    const arrivalDate = new Date();
                    arrivalDate.setHours(parseInt(arrivalParts[0]), parseInt(arrivalParts[1]), 0, 0);
                    
                    const departureDate = new Date();
                    departureDate.setHours(parseInt(departureParts[0]), parseInt(departureParts[1]), 0, 0);
                    
                    let hours = Math.max(0, (departureDate - arrivalDate) / (1000 * 60 * 60));
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
                    if (departureDate < arrivalDate) {
                        hours = Math.max(0, (departureDate.getTime() + 24 * 60 * 60 * 1000 - arrivalDate.getTime()) / (1000 * 60 * 60));
                    }
                    
                    if (hours < 8) {
                        const confirmDeparture = confirm('Ø§Ù„Ù…ÙˆØ¸Ù Ø¹Ù…Ù„ ' + hours.toFixed(1) + ' Ø³Ø§Ø¹Ø© ÙÙ‚Ø· (Ø£Ù‚Ù„ Ù…Ù† 8 Ø³Ø§Ø¹Ø§Øª). Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§ÙØŸ');
                        if (!confirmDeparture) return;
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±
                    await db.collection('current_attendance').doc(existingAttendance.id).update({
                        departureTime: departureTime,
                        hours: parseFloat(hours.toFixed(1))
                    });
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
                    await db.collection('saturday_shifts').add({
                        employeeId: employeeId,
                        employeeName: employee.name,
                        date: today,
                        arrivalTime: existingAttendance.arrivalTime,
                        departureTime: departureTime,
                        hours: parseFloat(hours.toFixed(1)),
                        notes: null,
                        createdBy: currentUser.email,
                        createdAt: new Date()
                    });
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    existingAttendance.departureTime = departureTime;
                    existingAttendance.hours = parseFloat(hours.toFixed(1));
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ
                    saturdayShifts.push({
                        employeeId: employeeId,
                        employeeName: employee.name,
                        date: today,
                        arrivalTime: existingAttendance.arrivalTime,
                        departureTime: departureTime,
                        hours: parseFloat(hours.toFixed(1)),
                        notes: null,
                        createdBy: currentUser.email,
                        createdAt: new Date()
                    });
                    
                    showNotification('saturdayNotification', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù ' + employee.name + ' Ø§Ù„Ø³Ø§Ø¹Ø© ' + formatTime12Hour(departureTime) + ' (' + hours.toFixed(1) + ' Ø³Ø§Ø¹Ø©)', 'success');
                    
                } else {
                    showNotification('saturdayNotification', 'Ø§Ù„Ù…ÙˆØ¸Ù Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                    return;
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('saturdayAttendanceForm').reset();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                updateCurrentAttendees();
                updateTodayAttendees();
                updateSaturdayTable();
                updateMainStats();
                updateAttendanceButton();
                
            } catch (error) {
                console.error('Error handling attendance:', error);
                showNotification('saturdayNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù', 'error');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª
        function updateSaturdayTable() {
            const tbody = document.getElementById('saturdayTableBody');
            
            if (saturdayShifts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 3rem; color: var(--primary-200);">
                            <i data-lucide="calendar" style="width: 48px; height: 48px; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø©</p>
                        </td>
                    </tr>
                `;
                lucide.createIcons();
                return;
            }
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            const sortedShifts = [...saturdayShifts].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            tbody.innerHTML = '';
            
            sortedShifts.forEach(shift => {
                const row = document.createElement('tr');
                row.style.cssText = `
                    border-bottom: 1px solid rgba(0, 212, 255, 0.1);
                    transition: background-color 0.3s ease;
                `;
                
                row.addEventListener('mouseenter', () => {
                    row.style.backgroundColor = 'rgba(0, 212, 255, 0.05)';
                });
                
                row.addEventListener('mouseleave', () => {
                    row.style.backgroundColor = 'transparent';
                });
                
                const shiftDate = new Date(shift.date);
                const formattedDate = shiftDate.toLocaleDateString('ar-SA', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                
                const statusColor = shift.hours >= 8 ? 'var(--neon-green)' : 'var(--neon-yellow)';
                const statusText = shift.hours >= 8 ? 'Ù…ÙƒØªÙ…Ù„Ø©' : 'Ù†Ø§Ù‚ØµØ©';
                
                row.innerHTML = 
                    '<td style="padding: 0.75rem; color: var(--neon-blue); font-weight: 500;">' + shift.employeeName + '</td>' +
                    '<td style="padding: 0.75rem; text-align: center; color: var(--primary-200);">' + formattedDate + '</td>' +
                    '<td style="padding: 0.75rem; text-align: center; color: var(--neon-green);">' + formatTime12Hour(shift.arrivalTime) + '</td>' +
                    '<td style="padding: 0.75rem; text-align: center; color: var(--neon-red);">' + (shift.departureTime ? formatTime12Hour(shift.departureTime) : '--') + '</td>' +
                    '<td style="padding: 0.75rem; text-align: center; color: var(--neon-blue); font-weight: bold;">' + shift.hours + '</td>' +
                    '<td style="padding: 0.75rem; text-align: center; color: ' + statusColor + '; font-weight: 500;">' + statusText + '</td>';
                
                tbody.appendChild(row);
            });
        }

        // Ø­Ø³Ø§Ø¨ Ø³Ø§Ø¹Ø§Øª Ù†ÙˆØ¨ØªØ¬ÙŠØ© Ø§Ù„Ø³Ø¨Øª
        function calculateSaturdayHours() {
            const arrivalTime = document.getElementById('arrivalTime').value;
            const departureTime = document.getElementById('departureTime').value;
            const hoursDiv = document.getElementById('calculatedHours');
            const hoursText = document.getElementById('hoursText');
            const hoursWarning = document.getElementById('hoursWarning');
            
            if (!arrivalTime || !departureTime) {
                hoursDiv.classList.add('hidden');
                return;
            }
            
            const arrival = new Date(`2000-01-01T${arrivalTime}:00`);
            const departure = new Date(`2000-01-01T${departureTime}:00`);
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ø§Ù†ØµØ±Ø§Ù ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
            if (departure < arrival) {
                departure.setDate(departure.getDate() + 1);
            }
            
            const hours = Math.max(0, (departure - arrival) / (1000 * 60 * 60));
            
            if (hours > 0) {
                hoursText.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª: ${hours.toFixed(1)} Ø³Ø§Ø¹Ø©`;
                
                if (hours < 8) {
                    hoursWarning.classList.remove('hidden');
                } else {
                    hoursWarning.classList.add('hidden');
                }
                
                hoursDiv.classList.remove('hidden');
                lucide.createIcons();
            } else {
                hoursDiv.classList.add('hidden');
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ù†ÙˆØ¨ØªØ¬ÙŠØ© Ø§Ù„Ø³Ø¨Øª
        async function handleSaturdaySubmit() {
            const employeeId = document.getElementById('saturdayEmployee').value;
            const saturdayDate = document.getElementById('saturdayDate').value;
            const arrivalTime = document.getElementById('arrivalTime').value;
            const departureTime = document.getElementById('departureTime').value;
            const notes = document.getElementById('saturdayNotes').value;
            
            if (!employeeId) {
                showNotification('saturdayNotification', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
                return;
            }
            
            if (!saturdayDate) {
                showNotification('saturdayNotification', 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø¨Øª', 'error');
                return;
            }
            
            if (!arrivalTime || !departureTime) {
                showNotification('saturdayNotification', 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù', 'error');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠÙˆÙ… Ø³Ø¨Øª
            const selectedDate = new Date(saturdayDate);
            if (selectedDate.getDay() !== 6) {
                showNotification('saturdayNotification', 'Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„ÙŠØ³ ÙŠÙˆÙ… Ø³Ø¨Øª', 'error');
                return;
            }
            
            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
            const arrival = new Date(`2000-01-01T${arrivalTime}:00`);
            const departure = new Date(`2000-01-01T${departureTime}:00`);
            
            if (departure < arrival) {
                departure.setDate(departure.getDate() + 1);
            }
            
            const hours = Math.max(0, (departure - arrival) / (1000 * 60 * 60));
            
            if (hours < 8) {
                showNotification('saturdayNotification', 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ© 8 Ø³Ø§Ø¹Ø§Øª', 'error');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù†ÙˆØ¨ØªØ¬ÙŠØ© Ù…Ø³Ø¬Ù„Ø© Ù„Ù†ÙØ³ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ù†ÙØ³ Ø§Ù„ØªØ§Ø±ÙŠØ®
            const existingShift = saturdayShifts.find(shift => 
                shift.employeeId === employeeId && shift.date === saturdayDate
            );
            
            if (existingShift) {
                showNotification('saturdayNotification', 'ÙŠÙˆØ¬Ø¯ Ù†ÙˆØ¨ØªØ¬ÙŠØ© Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ù†ÙØ³ Ø§Ù„ØªØ§Ø±ÙŠØ®', 'error');
                return;
            }
            
            const employee = employees.find(emp => emp.id === employeeId);
            
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ©
                const shiftData = {
                    employeeId: employeeId,
                    employeeName: employee.name,
                    date: saturdayDate,
                    arrivalTime: arrivalTime,
                    departureTime: departureTime,
                    hours: parseFloat(hours.toFixed(1)),
                    notes: notes || null,
                    createdBy: currentUser.email,
                    createdAt: new Date()
                };
                
                // Ø­ÙØ¸ ÙÙŠ Firebase
                const docRef = await db.collection('saturday_shifts').add(shiftData);
                
                // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                saturdayShifts.push({
                    id: docRef.id,
                    ...shiftData
                });
                
                showNotification('saturdayNotification', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('saturdayForm').reset();
                document.getElementById('calculatedHours').classList.add('hidden');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                updateSaturdayTable();
                updateSaturdayStats();
                updateMainStats();
                
            } catch (error) {
                console.error('Error recording Saturday shift:', error);
                showNotification('saturdayNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ©', 'error');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª (Ø§Ø³ØªØ¨Ø¯Ù„Øª Ø¨Ù€ updateSaturdayTable)
        function updateSaturdayRecords() {
            updateSaturdayTable();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª
        function updateSaturdayStats() {
            const container = document.getElementById('saturdayStats');
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const totalShifts = saturdayShifts.length;
            const totalHours = saturdayShifts.reduce((sum, shift) => sum + shift.hours, 0);
            const averageHours = totalShifts > 0 ? (totalHours / totalShifts).toFixed(1) : 0;
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            const employeeStats = {};
            saturdayShifts.forEach(shift => {
                if (!employeeStats[shift.employeeId]) {
                    employeeStats[shift.employeeId] = {
                        name: shift.employeeName,
                        shifts: 0,
                        hours: 0
                    };
                }
                employeeStats[shift.employeeId].shifts++;
                employeeStats[shift.employeeId].hours += shift.hours;
            });
            
            const topEmployee = Object.values(employeeStats).sort((a, b) => b.shifts - a.shifts)[0];
            
            container.innerHTML = `
                <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="color: var(--neon-blue); font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">${totalShifts}</div>
                    <div style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª</div>
                </div>
                <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="color: var(--neon-green); font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">${totalHours.toFixed(1)}</div>
                    <div style="color: var(--primary-200); font-size: 0.9rem;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</div>
                </div>
                <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="color: var(--neon-yellow); font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">${averageHours}</div>
                    <div style="color: var(--primary-200); font-size: 0.9rem;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø§Ø¹Ø§Øª</div>
                </div>
                ${topEmployee ? `
                <div style="background: rgba(0, 35, 102, 0.2); border: 1px solid rgba(0, 212, 255, 0.2); border-radius: 8px; padding: 1rem; text-align: center;">
                    <div style="color: var(--neon-orange); font-size: 1rem; font-weight: bold; margin-bottom: 0.5rem;">${topEmployee.name}</div>
                    <div style="color: var(--primary-200); font-size: 0.9rem;">Ø§Ù„Ø£ÙƒØ«Ø± Ù†ÙˆØ¨ØªØ¬ÙŠØ§Øª (${topEmployee.shifts})</div>
                </div>
                ` : ''}
            `;
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©
        function selectLeaveType(button) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.leave-type-btn').forEach(btn => {
                btn.style.border = '2px solid var(--primary-600)';
                btn.style.background = 'none';
                btn.style.color = 'white';
                btn.classList.remove('active');
            });
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
            const type = button.dataset.type;
            selectedLeaveType = type;
            button.classList.add('active');
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            const colors = {
                regular: 'var(--neon-green)',
                emergency: 'var(--neon-yellow)',
                sick: 'var(--neon-red)',
                permission: 'var(--neon-orange)'
            };
            
            button.style.border = `2px solid ${colors[type]}`;
            button.style.background = `${colors[type]}20`;
            button.style.color = colors[type];
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®/Ø§Ù„ÙˆÙ‚Øª
            toggleDateTimeFields(type);
            calculateDuration();
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®/Ø§Ù„ÙˆÙ‚Øª
        function toggleDateTimeFields(type) {
            const dateFields = document.getElementById('dateFields');
            const timeFields = document.getElementById('timeFields');
            
            if (type === 'permission') {
                dateFields.classList.add('hidden');
                timeFields.classList.remove('hidden');
                document.getElementById('startDate').required = false;
                document.getElementById('endDate').required = false;
                document.getElementById('startTime').required = true;
                document.getElementById('endTime').required = true;
            } else {
                dateFields.classList.remove('hidden');
                timeFields.classList.add('hidden');
                document.getElementById('startDate').required = true;
                document.getElementById('endDate').required = true;
                document.getElementById('startTime').required = false;
                document.getElementById('endTime').required = false;
            }
        }

        // Ø¹Ø±Ø¶ Ø±ØµÙŠØ¯ Ø§Ù„Ù…ÙˆØ¸Ù
        function showEmployeeBalance() {
            const employeeId = document.getElementById('recordEmployee').value;
            const balanceDiv = document.getElementById('employeeBalance');
            const balanceInfo = document.getElementById('balanceInfo');
            
            if (!employeeId || !balanceDiv || !balanceInfo) {
                if (balanceDiv) balanceDiv.classList.add('hidden');
                return;
            }
            
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) {
                balanceDiv.classList.add('hidden');
                return;
            }
            
            const regularRemaining = (employee.regularBalance || 30) - (employee.regularUsed || 0);
            const emergencyRemaining = (employee.emergencyBalance || 7) - (employee.emergencyUsed || 0);
            
            const regularColor = regularRemaining > 5 ? 'var(--neon-green)' : 'var(--neon-red)';
            const emergencyColor = emergencyRemaining > 2 ? 'var(--neon-green)' : 'var(--neon-yellow)';
            
            balanceInfo.innerHTML = 
                '<div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">' +
                    '<span style="color: var(--primary-200);">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ</span>' +
                    '<span style="font-weight: bold; color: ' + regularColor + '">' + regularRemaining + ' ÙŠÙˆÙ…</span>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">' +
                    '<span style="color: var(--primary-200);">Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©</span>' +
                    '<span style="font-weight: bold; color: ' + emergencyColor + '">' + emergencyRemaining + ' ÙŠÙˆÙ…</span>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between;">' +
                    '<span style="color: var(--primary-200);">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</span>' +
                    '<span style="font-weight: bold; color: var(--neon-orange);">' + (employee.permissionHours || 0) + ' Ø³Ø§Ø¹Ø©</span>' +
                '</div>';
            
            balanceDiv.classList.remove('hidden');
            balanceDiv.classList.remove('hidden');
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø©
        function calculateDuration() {
            const durationDiv = document.getElementById('calculatedDuration');
            const durationText = document.getElementById('durationText');
            const permissionWarning = document.getElementById('permissionWarning');
            
            if (!durationDiv) return;
            
            let duration = 0;
            let unit = 'ÙŠÙˆÙ…';
            
            if (selectedLeaveType === 'permission') {
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                
                if (startTime && endTime) {
                    const start = new Date(`2000-01-01T${startTime}:00`);
                    const end = new Date(`2000-01-01T${endTime}:00`);
                    duration = Math.max(0, (end - start) / (1000 * 60 * 60));
                    unit = 'Ø³Ø§Ø¹Ø©';
                }
            } else {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    duration = Math.max(0, Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1);
                }
            }
            
            if (duration > 0) {
                durationText.textContent = `Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©: ${duration} ${unit}`;
                
                // ØªØ­Ø°ÙŠØ± Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª
                if (selectedLeaveType === 'permission' && duration >= 7) {
                    const daysToDeduct = Math.floor(duration / 7);
                    permissionWarning.textContent = `âš ï¸ Ø³ÙŠØªÙ… Ø®ØµÙ… ${daysToDeduct} ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ`;
                    permissionWarning.classList.remove('hidden');
                } else {
                    permissionWarning.classList.add('hidden');
                }
                
                durationDiv.classList.remove('hidden');
                lucide.createIcons();
            } else {
                durationDiv.classList.add('hidden');
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©
        async function handleRecordSubmit() {
            const employeeId = document.getElementById('recordEmployee').value;
            const notes = document.getElementById('recordNotes').value;
            
            if (!employeeId) {
                showNotification('recordNotification', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
                return;
            }
            
            const employee = employees.find(emp => emp.id === employeeId);
            let duration = 0;
            let startDate = '';
            let endDate = '';
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ®
            if (selectedLeaveType === 'permission') {
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                
                if (!startTime || !endTime) {
                    showNotification('recordNotification', 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¥Ø°Ù†', 'error');
                    return;
                }
                
                const start = new Date(`2000-01-01T${startTime}:00`);
                const end = new Date(`2000-01-01T${endTime}:00`);
                duration = Math.max(0, (end - start) / (1000 * 60 * 60));
                startDate = new Date().toISOString().split('T')[0];
            } else {
                startDate = document.getElementById('startDate').value;
                endDate = document.getElementById('endDate').value;
                
                if (!startDate || !endDate) {
                    showNotification('recordNotification', 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©', 'error');
                    return;
                }
                
                const start = new Date(startDate);
                const end = new Date(endDate);
                duration = Math.max(0, Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1);
            }
            
            if (duration <= 0) {
                showNotification('recordNotification', 'Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯
            if (selectedLeaveType === 'regular') {
                const remaining = (employee.regularBalance || 30) - (employee.regularUsed || 0);
                if (duration > remaining) {
                    showNotification('recordNotification', `Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining} ÙŠÙˆÙ…`, 'error');
                    return;
                }
            } else if (selectedLeaveType === 'emergency') {
                const remaining = (employee.emergencyBalance || 7) - (employee.emergencyUsed || 0);
                if (duration > remaining) {
                    showNotification('recordNotification', `Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ø§Ø±Ø¶Ø© ØºÙŠØ± ÙƒØ§ÙÙŠ. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining} ÙŠÙˆÙ…`, 'error');
                    return;
                }
            }
            
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ø¬Ù„
                const recordData = {
                    employeeId: employeeId,
                    employeeName: employee.name,
                    type: selectedLeaveType,
                    duration: duration,
                    startDate: startDate,
                    endDate: endDate || startDate,
                    notes: notes || null,
                    createdBy: currentUser.email,
                    createdAt: new Date()
                };
                
                if (selectedLeaveType === 'permission') {
                    recordData.startTime = document.getElementById('startTime').value;
                    recordData.endTime = document.getElementById('endTime').value;
                }
                
                // Ø­ÙØ¸ ÙÙŠ Firebase
                await db.collection('leave_records').add(recordData);
                
                // ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø­Ù„ÙŠØ§Ù‹
                if (selectedLeaveType === 'regular') {
                    employee.regularUsed = (employee.regularUsed || 0) + duration;
                } else if (selectedLeaveType === 'emergency') {
                    employee.emergencyUsed = (employee.emergencyUsed || 0) + duration;
                } else if (selectedLeaveType === 'sick') {
                    employee.sickUsed = (employee.sickUsed || 0) + duration;
                } else if (selectedLeaveType === 'permission') {
                    const totalPermissionHours = (employee.permissionHours || 0) + duration;
                    const daysToDeduct = Math.floor(totalPermissionHours / 7);
                    const remainingHours = totalPermissionHours % 7;
                    
                    employee.permissionHours = remainingHours;
                    employee.regularUsed = (employee.regularUsed || 0) + daysToDeduct;
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø®ØµÙ… Ø¥Ø°Ø§ Ø­Ø¯Ø«
                    if (daysToDeduct > 0) {
                        await db.collection('leave_records').add({
                            employeeId: employeeId,
                            employeeName: employee.name,
                            type: 'permission_deducted',
                            duration: daysToDeduct,
                            startDate: startDate,
                            endDate: startDate,
                            notes: `Ø®ØµÙ… ${daysToDeduct} ÙŠÙˆÙ… Ù…Ù† ØªØ¬Ù…ÙŠØ¹ ${totalPermissionHours} Ø³Ø§Ø¹Ø© Ø£Ø°ÙˆÙ†Ø§Øª`,
                            createdBy: currentUser.email,
                            createdAt: new Date()
                        });
                    }
                }
                
                // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                const typeNames = {
                    regular: 'Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©',
                    emergency: 'Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©',
                    sick: 'Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…Ø±Ø¶ÙŠØ©',
                    permission: 'Ø§Ù„Ø¥Ø°Ù†'
                };
                
                showNotification('recordNotification', `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${typeNames[selectedLeaveType]} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('recordForm').reset();
                selectLeaveType(document.querySelector('[data-type="regular"]'));
                document.getElementById('employeeBalance').classList.add('hidden');
                document.getElementById('calculatedDuration').classList.add('hidden');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                updateBalancesView();
                showEmployeeBalance();
                
            } catch (error) {
                console.error('Error recording leave:', error);
                showNotification('recordNotification', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©', 'error');
            }
        }

        function updateBalancesView() {
            const container = document.getElementById('balancesContent');
            if (!container) {
                console.warn('balancesContent container not found');
                return;
            }
            
            container.innerHTML = '';
            
            if (employees.length === 0) {
                container.innerHTML = 
                    '<div style="text-align: center; padding: 2rem; color: var(--primary-200);">' +
                        '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¸ÙÙŠÙ†</p>' +
                        '<p style="margin-top: 1rem; font-size: 0.9rem;">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ù† ØªØ¨ÙˆÙŠØ¨ "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"</p>' +
                    '</div>';
                updateMainStats();
                return;
            }
            
            employees.forEach(employee => {
                const regularRemaining = (employee.regularBalance || 30) - (employee.regularUsed || 0);
                const emergencyRemaining = (employee.emergencyBalance || 7) - (employee.emergencyUsed || 0);
                const regularPercentage = (regularRemaining / (employee.regularBalance || 30)) * 100;
                
                const balanceClass = regularPercentage > 60 ? 'high' : regularPercentage > 30 ? 'medium' : 'low';
                const balanceColor = balanceClass === 'high' ? 'var(--neon-green)' : 
                                   balanceClass === 'medium' ? 'var(--neon-yellow)' : 'var(--neon-red)';
                
                const card = document.createElement('div');
                card.style.cssText = `
                    background: rgba(0, 35, 102, 0.3);
                    border: 1px solid rgba(0, 212, 255, 0.3);
                    border-radius: 8px;
                    padding: 1rem;
                    transition: all 0.3s ease;
                    min-height: 180px;
                `;
                
                const emergencyPercentage = (emergencyRemaining / (employee.emergencyBalance || 7)) * 100;
                
                card.innerHTML = 
                    '<div style="margin-bottom: 0.75rem;">' +
                        '<h3 style="color: var(--neon-blue); font-weight: 600; margin-bottom: 0.25rem; font-size: 1rem;">' + employee.name + '</h3>' +
                        '<p style="color: var(--primary-200); font-size: 0.8rem;">' + employee.department + '</p>' +
                    '</div>' +
                    '<div style="margin-bottom: 0.75rem;">' +
                        '<div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">' +
                            '<span style="color: var(--primary-200);">Ø§Ø¹ØªÙŠØ§Ø¯ÙŠ</span>' +
                            '<span style="color: ' + balanceColor + '; font-weight: bold;">' + regularRemaining + '/' + (employee.regularBalance || 30) + '</span>' +
                        '</div>' +
                        '<div style="height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden;">' +
                            '<div style="height: 100%; background: ' + balanceColor + '; width: ' + regularPercentage + '%; transition: width 0.3s ease;"></div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-bottom: 0.75rem;">' +
                        '<div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">' +
                            '<span style="color: var(--primary-200);">Ø¹Ø§Ø±Ø¶Ø©</span>' +
                            '<span style="color: var(--neon-yellow); font-weight: bold;">' + emergencyRemaining + '/' + (employee.emergencyBalance || 7) + '</span>' +
                        '</div>' +
                        '<div style="height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden;">' +
                            '<div style="height: 100%; background: var(--neon-yellow); width: ' + emergencyPercentage + '%; transition: width 0.3s ease;"></div>' +
                        '</div>' +
                    '</div>' +
                    
                    '<div style="display: flex; justify-content: space-between; font-size: 0.8rem;">' +
                        '<span style="color: var(--primary-200);">Ø£Ø°ÙˆÙ†Ø§Øª</span>' +
                        '<span style="color: var(--neon-orange); font-weight: bold;">' + (employee.permissionHours || 0) + 'Ø³</span>' +
                    '</div>';
                
                container.appendChild(card);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            updateMainStats();
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            if (document.getElementById('employeesTab') && !document.getElementById('employeesTab').classList.contains('hidden')) {
                updateEmployeeStats();
            }
        }

        function switchTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.add('hidden');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-button').forEach(button => {
                button.style.color = 'var(--primary-200)';
                button.style.borderBottomColor = 'transparent';
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            const targetTab = document.getElementById(tabName + 'Tab');
            if (targetTab) {
                targetTab.classList.remove('hidden');
            }
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.style.color = 'var(--neon-blue)';
                activeButton.style.borderBottomColor = 'var(--neon-blue)';
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (tabName === 'record') {
                loadEmployeeOptions();
            } else if (tabName === 'saturday') {
                loadEmployeeOptions();
                updateCurrentDate();
                updateCurrentAttendees();
                updateTodayAttendees();
                updateSaturdayTable();
                updateSaturdayStats();
                updateAttendanceButton();
            } else if (tabName === 'employees') {
                // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¹Ù†Ø¯ ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                if (departments.length === 0) {
                    console.log('Loading departments for employees tab...');
                    loadDepartments();
                } else {
                    updateDepartmentSelects();
                }
                filteredEmployees = [];
                currentPage = 1;
                updateEmployeesTable();
                updateEmployeeStats();
                resetEmployeeForm();
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
            lucide.createIcons();
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Firebase
            if (typeof firebase === 'undefined' || !auth) {
                console.warn('Firebase not available, using local authentication');
            }
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            let actualEmail = email;
            let userAccount = null;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ„ÙŠØ³ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            if (!email.includes('@') && usernames[email.toLowerCase()]) {
                const userData = usernames[email.toLowerCase()];
                actualEmail = userData.email;
                userAccount = userData;
            } else if (testAccounts[email]) {
                userAccount = testAccounts[email];
            }
            
            console.log('Attempting login with:', actualEmail);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginLoading = document.getElementById('loginLoading');
            
            if (!loginBtn || !loginBtnText || !loginLoading) {
                console.error('Login form elements not found');
                return;
            }
            
            loginBtnText.classList.add('hidden');
            loginLoading.classList.remove('hidden');
            loginBtn.disabled = true;

            try {
                if (typeof firebase !== 'undefined' && auth) {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Firebase
                    console.log('Attempting Firebase login...');
                    const userCredential = await auth.signInWithEmailAndPassword(actualEmail, password);
                    console.log('Firebase login successful:', userCredential.user.email);
                    currentUser = {
                        email: userCredential.user.email,
                        role: userAccount?.role || testAccounts[actualEmail]?.role || 'Ù…Ø³ØªØ®Ø¯Ù…'
                    };
                } else {
                    // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø­Ù„ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    console.log('Using local authentication...');
                    if (userAccount && userAccount.password === password) {
                        currentUser = {
                            email: actualEmail,
                            role: userAccount.role
                        };
                        console.log('Local login successful');
                    } else {
                        throw new Error('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                    }
                }
                
                showNotification('loginNotification', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø±Ø¨Ø¹ "ØªØ°ÙƒØ±Ù†ÙŠ" Ù…Ø­Ø¯Ø¯
                saveLoginData();
                
                setTimeout(() => {
                    showMainScreen();
                    loadData();
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ© Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    setTimeout(() => {
                        showSeasonalMessage();
                    }, 1000);
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹';
                } else {
                    errorMessage = error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
                }
                
                showNotification('loginNotification', errorMessage, 'error');
            } finally {
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                loginBtnText.classList.remove('hidden');
                loginLoading.classList.add('hidden');
                loginBtn.disabled = false;
            }
        }

        async function handleLogout() {
            try {
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                cleanupRealtimeListeners();
                isRealtimeEnabled = false;
                realtimeStatus = 'disconnected';
                
                if (typeof firebase !== 'undefined' && auth) {
                    await auth.signOut();
                }
                console.log('User logged out');
                currentUser = null;
                showLoginScreen();
            } catch (error) {
                console.error('Logout error:', error);
                // Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ FirebaseØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ø­Ù„ÙŠØ§Ù‹
                cleanupRealtimeListeners();
                currentUser = null;
                showLoginScreen();
            }
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        function showMainScreen() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            
            // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
            const userWelcome = document.getElementById('userWelcome');
            if (currentUser) {
                const userName = currentUser.email === 'admin@company.com' ? 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…' : 
                               currentUser.email === 'supervisor@company.com' ? 'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø£ÙˆÙ„' : 'Ù…ÙˆØ¸Ù ØªØ¬Ø±ÙŠØ¨ÙŠ';
                userWelcome.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userName} (${currentUser.email})`;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateMainStats();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù„Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† (ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©)
            setInterval(() => {
                if (document.getElementById('saturdayTab') && !document.getElementById('saturdayTab').classList.contains('hidden')) {
                    updateCurrentAttendees();
                    updateTodayAttendees();
                }
            }, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }

        function showNotification(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            if (!container) {
                console.warn('Notification container not found:', containerId);
                console.log('Message:', message);
                return;
            }
            
            const notification = document.createElement('div');
            notification.className = 'notification ' + type;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'x-circle' : 'alert-circle';
            
            notification.innerHTML = 
                '<i data-lucide="' + icon + '"></i>' +
                '<span>' + message + '</span>';
            
            container.innerHTML = '';
            container.appendChild(notification);
            
            lucide.createIcons();
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
